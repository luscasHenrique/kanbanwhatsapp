window.addEventListener("message",async function(e){if(e.source===window.parent&&"controler"===e.data.type){let a=await controlerWPP(e.data);window.parent.postMessage({type:"returnControler",id:e.data.id,response:JSON.stringify(a)},"*")}});const controler={async loadPictureChat(){let e=await window[Ue].Chat._models;for(let a=0;a<e.length;a++){if(e[a].picture)return;e[a].picture=await WPP.contact.getProfilePictureUrl(e[a].__x_id._serialized)}},async getListContact(){let e=await window[Ue].Chat._models,a=[];for(let t of e){let s={assinatura:t.assinatura,picture:t.picture,labels:t.__x_labels,id:t.__x_id.user,name:t.__x_contact.__x_displayName||t.__x_contact.__x_searchName};a.push(s)}return a},async getActiveChat(e){let a=await WPP.chat.getActiveChat();switch(e){case"id":a=a.__x_id.user;break;case"labels":a=a.__x_labels;break;default:a={id:a.__x_id.user,serialized:a.__x_id._serialized,picture:a.picture,labels:a.__x_labels,title:a.__x_formattedTitle,name:a.__x_contact.__x_formattedName}}return a},async getContato(e){let a=await WPP.contact.list(),t={name:function e(a){let t=a.slice(0,2),s=a.slice(2,4),r=a.slice(4,9),i=a.slice(9),l=`+${t} ${s} ${r}-${i}`;return l}(e),labels:[]};for(let s of a)if(s.__x_id.user==e){t={name:s.__x_displayName,labels:s.__x_labels};break}return t}},controlerWPP=async e=>{let a=[];switch(e.action){case"isBusiness":a=await WPP.profile.isBusiness();break;case"labels":a=await WPP.labels.getAllLabels();break;case"getPicture":a=await WPP.contact.getProfilePictureUrl(e.dados.num);break;case"getListContact":a=await controler.getListContact();break;case"getActiveChat":a=await controler.getActiveChat(e.dados);break;case"loadPictureChat":a=await controler.loadPictureChat();break;case"addOrRemoveLabels":console.log(e.dados),a=await WPP.labels.addOrRemoveLabels(e.dados.id,[e.dados.label]);break;case"getContato":a=await controler.getContato(e.dados);break;case"setNameUser":console.log(e.dados),wppRequest._save_editContato(e.dados),a="Success";break;default:a="Error invalid action"}return void 0==a?"undefined":a};