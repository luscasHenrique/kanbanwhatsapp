let language,activeID="";var darkMode,menuDisplay=document.createElement("div"),openQAActive=!0,openQAEstado=!0;const storageKeys=["guardaMsg","contatos","agendaMsg","assinatura","finalizar"];storageKeys.forEach(e=>{chrome.storage.local.get(e,t=>{void 0===t[e]&&chrome.storage.local.set({[e]:[]},()=>init())})});const waitForEl=(e,t)=>{document.querySelector(e)?t():setTimeout(()=>{waitForEl(e,t)},300)},readLocalStorage=async e=>new Promise((t,a)=>{chrome.storage.local.get([e],function(l){void 0===l[e]?a():t(l[e])})}),generateSlug=e=>e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),validateLicense=async e=>{try{if(await readLocalStorage("license"))return!0}catch(t){}let a=await readLocalStorage("userTabs");if("newTab"==e)return a.length<1;let l=await readLocalStorage("notifications");if("notifications"==e)return l.length<3;let i=await readLocalStorage("notes");if("notes"==e)return i.length<3;let n=await readLocalStorage("events");if("events"==e)return n.length<2;let s=await readLocalStorage("agendaMsg");if("agendaMsg"==e)return s.length<1},injectSystemTab=(e,t)=>{t.innerHTML+=`<span class="menu_item" data-id="${e.tag}">
                                <input class="menu_input" id="${language[e.tag]}" name="menu" type="radio" onclick="renderSystemTab('${e.tag}')" data-tag="${e.tag}" data-type="${e.type}" />
                                <label id="${e.tag+"_label"}" class="menu_label" for="${language[e.tag]}" aria-describedby="tooltip">
                                    <div class="menu_text">
                                        ${language[e.tag]}
                                    </div>
                                </label>
                            </span>`,setTimeout(()=>{let t=document.querySelector(`[data-id='${e.tag}']`),a=document.createElement("span");a.addEventListener("click",t=>{var a=t.clientX;showEditChatsDropdown(t.target.closest(".menu_item"),a,e,!1)}),a.classList.add("editTabMenu"),t.appendChild(a)},200),setTimeout(()=>{GFN.initTitle(document.querySelector(`#${e.tag+"_label"}`),language[e.tag+"_popover"],"bottom")},200)},updateTabChats=async(e,t=!1,a=!1,l=null)=>{let i=await readLocalStorage("userTabs"),n=[],s=await GFN.Wpp_Request("getListContact");console.log(s);let d=Date.now();document.querySelectorAll(".waTidy_chats_list .check.active").forEach(async e=>{let t=s.find(t=>t.id==e.closest("li").dataset.id);t||(t={picture:void 0,name:void 0,dataEntrada:d,etiqueta:[]}),console.log(t);let a={id:e.closest("li").dataset.id,picture:t.picture,name:t.name,dataEntrada:d,etiqueta:t.labels};n.push(a)}),console.log(n);let r=i.find(t=>t.tag==e);if(t)r.chats=[...r.chats,...n];else if(a){r.chats=[...r.chats,...n];let c=i.find(e=>e.tag==l.tag);c.chats=c.chats.filter(e=>!n.find(t=>t.id==e.id))}else r.chats=n;chrome.storage.local.set({userTabs:i},()=>{init()}),chrome.runtime.sendMessage({action:"abaListUpdate",aba:e})};async function loadMsg(){return await readLocalStorage("guardaMsg")}var msgRapidas=loadMsg();const filterList=()=>{var e,t,a,l,i,n,s;if(t=(e=document.getElementById("searchInput")).value.toUpperCase(),l=(a=document.querySelector(".waTidy_chats_list")).getElementsByTagName("li"),document.querySelectorAll(".check").forEach(e=>{e.classList.add("true")}),""==t.trim())for(n=0;n<l.length;n++){l[n].style.display="";l[n].querySelector(".item-container > .check").classList.remove("True")}else for(n=0;n<l.length;n++)if((s=(i=l[n].getElementsByTagName("label")[0]).textContent||i.innerText).toUpperCase().indexOf(t)>-1)l[n].style.display="";else{l[n].style.display="none";l[n].querySelector(".item-container > .check").classList.remove("true")}},showManageTabChatsModel=e=>{closeEditDropdowns();let t=document.createElement("div");t.classList.add("waTidy_modal"),t.setAttribute("id","modalShowTab");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.edit_chats_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.innerText=language.edit_chats_text;let s=document.createElement("div");s.style.display="flex";let d=document.createElement("input");d.classList.add("waTidy_modal_input"),d.classList.add("waTidy_modal_user_tab_input"),d.addEventListener("keyup",()=>filterList()),d.setAttribute("id","searchInput"),d.setAttribute("type","text"),d.setAttribute("autocomplete","off"),d.setAttribute("placeholder",language.edit_chats_search_placeholder),d.style.height="18px",d.style.marginTop="13px",d.style.width="65%";let r=document.createElement("div");r.classList.add("waTidy_chats_list");let c=document.createElement("ul");r.appendChild(c),(loading=document.createElement("div")).classList.add("loading"),loading.style.display="none";let o=document.createElement("p");function p(e){let t=o.getAttribute("list"),a=document.querySelectorAll(".item-container > .check");"add"===t?(a.forEach(e=>{e.classList.add("active")}),o.innerText=language.copy_chats_deselect_all,o.setAttribute("list","remove")):(a.forEach(e=>{e.classList.remove("active")}),o.innerText=language.copy_chats_select_all,o.setAttribute("list","add"))}o.innerText=language.copy_chats_select_all,o.classList.add("waTidy_select_all_chats_btn"),o.setAttribute("list","add"),o.addEventListener("click",e=>{chrome.storage.local.get("license",t=>{if(t.license)p(e);else{let a="#modalShowTab",l=language.selecionarTodosFree;GFN.modalPremium(a,l)}})});let g=document.createElement("div");g.style.display="flex";let u=document.createElement("button");u.innerText=language.save,u.classList.add("waTidy_modal_button"),u.addEventListener("click",()=>updateTabChats(e));let m=document.createElement("button");m.classList.add("waTidy_modal_button"),m.style.backgroundColor="#bb2828",m.innerText=language.campain_clear,m.addEventListener("click",()=>{let t=""==document.querySelector("#searchInput").value.trim()?".check":".check.true";Swal.fire({title:language.swal_clearAba_titulo,text:language.swal_clearAba_desc,color:"var(--textSwal)",icon:"warning",iconColor:"red",background:"var(--waTidy-modal-bg)",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:language.cancel,confirmButtonText:language.campain_clear}).then(e=>{e.isConfirmed&&(a(t),Swal.fire({title:"Deleted!",text:language.swal_clearAba_success,color:"var(--textSwal)",icon:"success",iconColor:"limegreen",background:"var(--waTidy-modal-bg)"}))});let a=t=>{document.querySelectorAll(t),document.querySelectorAll(t).forEach(e=>{e.classList.contains("active")&&e.click()}),updateTabChats(e)}}),g.appendChild(m),g.appendChild(u),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(s),s.appendChild(d),s.appendChild(o),s.appendChild(loading),a.appendChild(r),a.appendChild(g),t.appendChild(a),document.body.appendChild(t),window.postMessage({action:"getDataForEditTab",tag:e},"*")},showExportContactsToTabModel=e=>{let t=e.tag;closeEditDropdowns();let a=document.createElement("div");a.classList.add("waTidy_modal");let l=document.createElement("div");l.classList.add("waTidy_modal_content");let i=document.createElement("button");i.classList.add("waTidy_modal_close_btn"),i.addEventListener("click",()=>{a.remove()});let n=document.createElement("h1");n.classList.add("waTidy_modal_heading"),n.innerText=language.copy_chats_heading;let s=document.createElement("p");s.classList.add("waTidy_modal_desc"),s.innerText=language.copy_chats_text;let d=document.createElement("input");d.classList.add("waTidy_modal_input"),d.classList.add("waTidy_modal_user_tab_input"),d.addEventListener("keyup",()=>filterList()),d.setAttribute("id","searchInput"),d.setAttribute("type","text"),d.setAttribute("autocomplete","off"),d.setAttribute("placeholder",language.edit_chats_search_placeholder);let r=document.createElement("p");r.innerText=language.copy_chats_select_all,r.classList.add("waTidy_select_all_chats_btn"),r.addEventListener("click",e=>{let t=""==d.value.trim()?".check":".check.true";e.target.innerText==language.copy_chats_select_all?(document.querySelectorAll(t).forEach(e=>{e.classList.contains("active")||e.click()}),e.target.innerText=language.copy_chats_deselect_all):(document.querySelectorAll(t).forEach(e=>{e.classList.contains("active")&&e.click()}),e.target.innerText=language.copy_chats_select_all)});let c=document.createElement("div");c.classList.add("waTidy_chats_list");let o=document.createElement("ul");c.appendChild(o);let p=document.createElement("div");p.classList.add("waTidy_copy_chats_footer");let g=document.createElement("label");g.innerText=language.copy_chats_select_label;let u=document.createElement("select");chrome.storage.local.get("userTabs",e=>{e.userTabs.forEach(e=>{if(e.tag==t)return;let a=document.createElement("option");a.setAttribute("value",e.tag),a.innerText=e.tag,u.appendChild(a)})});let m=document.createElement("div");m.style.display="flex";let h=document.createElement("button");if(h.innerText=language.copy_btn_label,h.classList.add("waTidy_modal_button"),h.addEventListener("click",()=>updateTabChats(u.value,!0)),"user"==e.type){let v=document.createElement("button");v.innerText=language.copy_move_btn_label,v.classList.add("waTidy_modal_button"),v.addEventListener("click",()=>updateTabChats(u.value,!1,!0,e)),m.appendChild(v)}m.appendChild(h),l.appendChild(i),l.appendChild(n),l.appendChild(s),l.appendChild(d),l.appendChild(r),l.appendChild(c),p.appendChild(g),p.appendChild(u),l.appendChild(p),l.appendChild(m),a.appendChild(l),document.body.appendChild(a),window.postMessage({action:"getDataForCopyChats",tab:e},"*")};let closeEditDropdowns=()=>{document.querySelectorAll(".edit_chats_dropdown").forEach(e=>{e.remove()})};var contentDiv=document.createElement("div");contentDiv.setAttribute("id","contentMsgRapidas");const showCreateMensagensRapidas=e=>{closeEditDropdowns();let t=document.createElement("div");t.classList.add("waTidy_modal"),contentDiv.innerHTML="",contentDiv.classList.add("waTidy_modal_content"),renderMensagensRapidas(e,t,contentDiv)},showImportByLabelModal=e=>{closeEditDropdowns();let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.tab_setting_import;let n=document.createElement("div");n.classList.add("waTidy_chats_list");let s=document.createElement("ul");n.appendChild(s);let d=document.createElement("button");d.innerText=language.tab_setting_import_label,d.classList.add("waTidy_modal_button"),d.addEventListener("click",t=>{window.postMessage({action:"importByLabel",tab:e},"*")}),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(d),t.appendChild(a),document.body.appendChild(t),window.postMessage({action:"getDataForImportByLabel",tab:e},"*")},showEditChatsDropdown=(e,t,a,l=!0)=>{let i=a.tag,n=document.querySelector(`[data-for='${i}']`);if(closeEditDropdowns(),n)return;let s=document.createElement("div");if(s.style.left=t-70+"px",s.classList.add("edit_chats_dropdown"),l){let d=document.createElement("span");d.dataset.for=i,d.classList.add("edit_chats_dropdown_btn"),d.innerText=language.tab_setting_edit,d.addEventListener("click",()=>{showManageTabChatsModel(i)}),s.appendChild(d);let r=document.createElement("span");r.dataset.for=i,r.classList.add("edit_chats_dropdown_btn"),r.innerText=language.tab_setting_import,r.addEventListener("click",e=>{chrome.storage.local.get("license",e=>{if(e.license)showImportByLabelModal(a);else{let t=!1,l=language.etiquetaImpFree;GFN.modalPremium(t,l)}})}),s.appendChild(r)}let c=document.createElement("span");c.dataset.for=i,c.classList.add("edit_chats_dropdown_btn"),c.innerText=language.tab_setting_export,c.addEventListener("click",e=>{chrome.storage.local.get("license",e=>{if(e.license)showExportContactsToTabModel(a);else{let t=!1,l=language.exportTabFree;GFN.modalPremium(t,l)}})}),s.appendChild(c);let o=document.createElement("span");o.dataset.for=i,o.classList.add("edit_chats_dropdown_btn"),o.innerText=language.exporta_aba,o.addEventListener("click",async()=>{if(!0===await GFN.isFree()){GFN.modalPremium(!1,language.alert_free_aba);return}if(0===a.chats.length){GFN.notificacao("error",language.export_aba_error),document.querySelector(".edit_chats_dropdown")?.remove();return}let e=a.chats,t=XLSX.utils.json_to_sheet(e.map(e=>({"N\xfameros Whatsapp":e.id,Name:e.name})),{header:[language.export_planilha_name],skipHeader:!1});t["!cols"]=[{width:20}];let l=XLSX.utils.book_new();XLSX.utils.book_append_sheet(l,t,language.export_planilha_name);let n=XLSX.write(l,{bookType:"xlsx",type:"array"}),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a");d.href=URL.createObjectURL(s),d.download=`watidy_aba_${i}.xlsx`,d.click(),GFN.notificacao("success",language.export_aba_success)}),"tab_all"!==e.attributes[1].value&&"tab_unread"!==e.attributes[1].value&&"tab_groups"!==e.attributes[1].value&&"tab_1_1"!==e.attributes[1].value&&s.appendChild(o),e.appendChild(s)},injectUserTab=(e,t)=>{t.innerHTML+=`<span class="menu_item" data-id="${e.tag}">
                                <input class="menu_input" id="${generateSlug(e.tag)}" name="menu" type="radio" onclick="initRenderUserTab()" data-tag="${e.tag}" data-type="${e.type}" />
                                <label id="${e.tag+"_label"}" class="menu_label" for="${generateSlug(e.tag)}">
                                    <div class="menu_text">
                                        ${e.tag} (${e.chats.length})
                                    </div>
                                </label>
                            </span>`,setTimeout(()=>{let t=document.querySelector(`[data-id='${e.tag}']`),a=document.createElement("span");a.addEventListener("click",t=>{var a=t.clientX;showEditChatsDropdown(t.target.closest(".menu_item"),a,e)}),a.classList.add("editTabMenu"),t.appendChild(a)},200),setTimeout(()=>{GFN.initTitle(document.getElementById(`${e.tag+"_label"}`),language.tab_custom_tab_popover,"bottom")},200)},closeDropDowns=(e=null)=>{let t=document.getElementsByClassName("dropdown_content");for(let a=0;a<t.length;a++){let l=t[a];l!=e&&l.classList.contains("show")&&l.classList.remove("show")}document.querySelector("#newTabInputContainer")?.remove()};window.onclick=function(e){e.target.closest(".dropbtn")||e.target.closest(".dropdown_content")||closeDropDowns(),e.target.closest(".editTabMenu")||e.target.closest(".edit_chats_dropdown")||closeEditDropdowns(),e.target.closest(".waTidy_modal_content")||e.target.closest(".edit_chats_dropdown")||e.target.closest(".delIcon")||document.querySelector(".waTidy_modal")?.remove(),e.target.closest("#modalEtiqueta")||(document.querySelector("#modalEtiqueta")?.removeAttribute("data-show"),document.querySelector("#modalEtiqueta")?.remove()),e.target.closest("#_modalAbas")||(document.querySelector("#_modalAbas")?.removeAttribute("data-show"),document.querySelector("#_modalAbas")?.remove(),!0!==CHANGER_TABS||(document.querySelector(".waTidy_container")?.remove(),injectTopBar(),waitForEl(".menu",()=>{initSortable()}),CHANGER_TABS=!1)),e.target.closest('[tag="showAnexos"]')&&!e.target.closest(".showAnexos_content")&&(document.querySelector(".mainCamp")?.classList.remove("op_0-3"),document.querySelector(".campanha_modal")?.remove()),e.target.closest("#menuPlus")||(document.querySelector("#menuPlus")?.removeAttribute("data-show"),document.querySelector("#menuPlus")?.remove(),document.querySelector("#menuPlusContainer").classList.remove("menuPlusActive")),document.querySelector("#allTitle")?.removeAttribute("data-show")};const changeLang=()=>{let e=document.querySelector("#langSel").value;chrome.storage.local.set({lang:e},()=>{init()}),chrome.runtime.sendMessage({action:"languageReload"})},deleteReminder=async e=>{let t=await readLocalStorage("notifications");t=t.filter(t=>t.id!=e),chrome.storage.local.set({notifications:t},()=>{document.body.click()})},showDelReminderModal=e=>{let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.reminder_delete;let n=document.createElement("button");n.innerText=language.delete,n.classList.add("waTidy_modal_button"),n.addEventListener("click",()=>deleteReminder(e));let s=document.createElement("button");s.innerText=language.cancel,s.classList.add("waTidy_modal_button"),s.addEventListener("click",()=>l.click());let d=document.createElement("div");d.style.display="flex",d.appendChild(s),d.appendChild(n),a.appendChild(l),a.appendChild(i),a.appendChild(d),t.appendChild(a),document.body.appendChild(t)},openChat=async(e,t)=>{let a=await readLocalStorage("notifications");a.find(t=>t.id==e).read=!0,chrome.storage.local.set({notifications:a},()=>{window.postMessage({action:"openChat",id:t},"*")})},injectRemindersDropdown=async e=>{e.innerHTML="";let t=document.createElement("div");t.classList.add("notifications_header");let a=document.createElement("p");a.innerText=language.notifications_title,t.appendChild(a),e.appendChild(t),e.innerHTML+=`<div class="tabsy">                          

                                <input type="radio" id="tab1" name="tab" checked>
                                <label class="tabButton" for="tab1">${language.notifications_inbox}</label>
                                <div class="tab">
                                    <div id="inboxContent" class="content"></div>
                                </div>

                                <input type="radio" id="tab2" name="tab">
                                <label class="tabButton" for="tab2">${language.notifications_upcoming}</label>
                                <div class="tab">
                                    <div id="upcomingContent" class="content"></div>
                                </div>
                               
                                ${watidyLabel?`<input type="radio" id="tab0" name="tab">
                                <label class="tabButton" for="tab0">Novidades</label>
                                <div class="tab">
                                   <div id="novidades" class="content"></div>
                                </div>   `:""}



                            </div>`;let l=await readLocalStorage("notifications");waitForEl("#inboxContent",()=>{let e=document.querySelector("#inboxContent"),t=document.querySelector("#upcomingContent"),a=document.querySelector("#novidades");watidyLabel&&(a.innerHTML=atualizacao);let i=new Date,n=l.filter(e=>{let t=`${e.date}T${e.time}:00${getTimezoneOffset()}`;return new Date(t)<=i}).sort((e,t)=>{let a=new Date(e.date),l=e.time.split(":");a.setHours(l[0],l[1]);let i=new Date(t.date),n=t.time.split(":");return i.setHours(n[0],n[1]),i-a}),s=l.filter(e=>{let t=`${e.date}T${e.time}:00${getTimezoneOffset()}`;return new Date(t)>i}).sort((e,t)=>{let a=new Date(e.date),l=e.time.split(":");a.setHours(l[0],l[1]);let i=new Date(t.date),n=t.time.split(":");return i.setHours(n[0],n[1]),a-i}),d=document.createElement("div");n.forEach(t=>{let a=document.createElement("div");a.classList.add("waTidy_notification_item");let l=document.createElement("div"),i=document.createElement("p");i.innerText=t.title;let n=document.createElement("p");n.innerText=`${t.date} at ${t.time}`,n.classList.add("watidy_notification_time");let s=document.createElement("span");if(s.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M6.667 9.334h10.666V18a.667.667 0 0 1-.666.667H7.333A.667.667 0 0 1 6.667 18V9.334zM8 10.667v6.667h8v-6.667H8zM10 12h1.333v4H10v-4zm2.667 0H14v4h-1.333v-4zm-4-4.667V6a.667.667 0 0 1 .666-.667h5.334a.667.667 0 0 1 .666.667v1.333h3.334v1.334H5.333V7.334h3.334zM10 6.667v.667h4v-.667h-4z"
                                                        fill="#939598"
                                                    />
                                                </svg>`,s.addEventListener("click",e=>{e.stopPropagation(),showDelReminderModal(t.id)}),l.appendChild(i),l.appendChild(n),a.appendChild(l),a.appendChild(s),!t.read){let d=document.createElement("span");d.classList.add("notifyIndicator"),l.prepend(d)}a.addEventListener("click",()=>{l.querySelector(".notifyIndicator")?.remove(),openChat(t.id,t.user_id)}),e.appendChild(a)}),e.appendChild(d);let r=document.createElement("div");s.forEach(e=>{let a=document.createElement("div");a.classList.add("waTidy_notification_item");let l=document.createElement("div"),i=document.createElement("p");i.innerText=e.title;let n=document.createElement("p");n.innerText=`On ${e.date} at ${e.time}`,n.classList.add("watidy_notification_time");let s=document.createElement("span");s.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M6.667 9.334h10.666V18a.667.667 0 0 1-.666.667H7.333A.667.667 0 0 1 6.667 18V9.334zM8 10.667v6.667h8v-6.667H8zM10 12h1.333v4H10v-4zm2.667 0H14v4h-1.333v-4zm-4-4.667V6a.667.667 0 0 1 .666-.667h5.334a.667.667 0 0 1 .666.667v1.333h3.334v1.334H5.333V7.334h3.334zM10 6.667v.667h4v-.667h-4z"
                                                        fill="#939598"
                                                    />
                                                </svg>`,s.addEventListener("click",t=>{t.stopPropagation(),showDelReminderModal(e.id)}),l.appendChild(i),l.appendChild(n),a.appendChild(l),a.appendChild(s),a.addEventListener("click",()=>openChat(e.id,e.user_id)),t.appendChild(a)}),t.appendChild(r)})},exportData=()=>{chrome.storage.local.get(null,e=>{let t=JSON.stringify(e),a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download","backup_wa.json"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)})},importInit=()=>{init(),resetMsgRapidas()},importData=()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept",".json"),e.click(),e.addEventListener("change",e=>{var t=e.target.files[0],a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=e=>{var t=e.target.result;if(JSON.parse(t)){let a=JSON.parse(t);chrome.storage.local.get(null,e=>{chrome.storage.local.set({systemTabs:e.systemTabs,menuItems:e.menuItems,ccList:e.ccList,lang:a.lang,privacySettings:a.privacySettings,guardaMsg:a.guardaMsg,agendaMsg:a.agendaMsg,assinatura:a.assinatura,zoomCRM:a.zoomCRM,perfil:a.perfil,valNegocio:a.valNegocio}),a.license?chrome.storage.local.set({license:e.license,agendaMsg:a.agendaMsg,notes:a.notes,notifications:a.notifications,userTabs:a.userTabs,events:a.events,guardaMsg:a.guardaMsg,contatos:a.contatos,assinatura:a.assinatura,zoomCRM:a.zoomCRM,perfil:a.perfil,valNegocio:a.valNegocio},importInit()):chrome.storage.local.set({notes:a.notes.slice(a.notes.length-3),agendaMsg:a.agendaMsg.slice(a.agendaMsg.length-1),notifications:a.notifications.slice(a.notifications.length-3),userTabs:a.userTabs.slice(a.userTabs.length-1),events:a.events.slice(a.events.length-2),guardaMsg:a.guardaMsg,contatos:a.contatos,assinatura:a.assinatura,zoomCRM:a.zoomCRM,perfil:a.perfil,valNegocio:a.valNegocio},importInit())})}chrome.runtime.sendMessage({action:"importBackup"})}})},activateLicense=async()=>{let e=document.querySelector("#licenseInput").value.trim();if(!e.length){showModalErr("licenese_input_error");return}let t=JSON.stringify({key:e});await fetch(`${labelLink.license}/licenses/activate`,{method:"PUT",body:t,headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(t=>{console.log(t),t?.succes?(console.log(t),menuDisplay.style.position="inherit",showModalErr("license_activate_success"),document.querySelector(".waTidy_modal_err").style.background="var(--waTidy-notification)",setTimeout(()=>{chrome.storage.local.set({keyCopy:e}),chrome.storage.local.set({license:t.token},()=>{init(),chrome.runtime.sendMessage({message:"setUninstallURL"})}),IS_FREE=!1},1e3)):showModalErr("licenese_activate_error")})},showActivateModal=e=>{e.stopPropagation();let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.license_activate_modal_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.innerText=language.license_activate_modal_caption;let s=document.createElement("p");s.classList.add("waTidy_modal_label"),s.innerText=language.license_activate_modal_label||"License Key";let d=document.createElement("input");d.setAttribute("id","licenseInput"),d.setAttribute("type","text"),d.setAttribute("placeholder",language.license_activate_modal_label),d.classList.add("waTidy_modal_input"),d.style.width="-webkit-fill-available",d.style.marginTop="1em";let r=document.createElement("button");r.innerText=language.confirm,r.classList.add("waTidy_modal_button"),r.addEventListener("click",activateLicense),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(s),a.appendChild(d),a.appendChild(r),t.appendChild(a),document.body.appendChild(t)},showUpgradeModal=e=>{e.stopPropagation();let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content"),a.style.width="50rem";let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.upgrade_modal_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.innerText=language.upgrade_modal_caption;let s=document.createElement("div");s.classList.add("plansDiv");let d=document.createElement("div");d.classList.add("planDiv");let r=document.createElement("h2");r.classList.add("planHeading"),r.innerText=language.free_plan_heading;let c=[language.feature_system_tabs,language.custom_tab_free_plan,language.notes_free_plan,language.reminders_free_plan,language.events_free_plan,language.free_agendar,language.free_campanha],o=document.createElement("div");o.classList.add("planFeatures"),c.forEach(e=>{let t=document.createElement("div"),a=document.createElement("img");a.setAttribute("src",chrome.runtime.getURL("/assets/images/svgs/check-grey.svg"));let l=document.createElement("p");l.innerText=e,t.appendChild(a),t.appendChild(l),o.appendChild(t)});let p=document.createElement("button");p.classList.add("waTidy_modal_button"),p.style.background="unset",p.style.border="1px solid var(--waTidy-primary)",p.style.color="var(--primary)",p.style.width="220px",p.innerText=language.free_plan_btn_label,p.addEventListener("click",()=>{t.remove()}),d.appendChild(r),d.appendChild(o),d.appendChild(p);let g=document.createElement("div");g.classList.add("planDiv");let u=document.createElement("h2");u.classList.add("planHeading"),u.innerText=language.paid_plan_heading;let m=[language.feature_system_tabs,language.custom_tab_paid_plan,language.notes_paid_plan,language.reminders_paid_plan,language.events_paid_plan,language.copy_paid_plan,language.export_paid_plan,language.campaign_paid_plan,language.premium_agendar,language.premium_campanha],h=document.createElement("div");h.classList.add("planFeatures"),m.forEach(e=>{let t=document.createElement("div"),a=document.createElement("img");a.setAttribute("src",chrome.runtime.getURL("/assets/images/svgs/check-green.svg"));let l=document.createElement("p");l.innerText=e,t.appendChild(a),t.appendChild(l),h.appendChild(t)});let v=document.createElement("button");v.classList.add("waTidy_modal_button"),v.innerText=language.paid_plan_btn_label,v.addEventListener("click",()=>{t.remove(),window.open(labelLink.comprar,"_blank")});let y=document.createElement("button");y.classList.add("waTidy_modal_button"),y.style.display="inline",y.style.marginLeft="6rem",y.innerHTML="Ativar Chave",y.addEventListener("click",e=>{t.remove(),showActivateModal(e)});let b=document.createElement("p");b.classList.add("activateLicenseLink"),b.innerText=language.license_activate_placeholder,b.addEventListener("click",e=>{t.remove(),showActivateModal(e)}),g.appendChild(u),g.appendChild(h),g.appendChild(v),g.appendChild(b),s.appendChild(d),s.appendChild(g),a.appendChild(l),a.appendChild(i),a.appendChild(y),a.appendChild(n),a.appendChild(s),t.appendChild(a),document.body.appendChild(t)},updatePrivacySettings=()=>{let e=document.querySelectorAll(".switch > input"),t={};e.forEach(e=>{t[e.getAttribute("id")]=e.checked}),chrome.storage.local.set({privacySettings:t})},injectMenuDropdown=async e=>{let t=async e=>{let t=document.createElement("div");t.classList.add("waTidy_notification_item"),t.setAttribute("tag","privacy"),t.setAttribute("active","off"),t.setAttribute("style","align-items: center;margin-top: 0.5em; cursor:pointer;"),e.insertAdjacentElement("beforeend",t);let a=document.createElement("label");a.setAttribute("for","lang"),a.setAttribute("style","font-weight:bold; cursor:pointer;"),a.innerHTML=language.privacy_label,t.appendChild(a);let l=document.createElement("svg");GFN.initTitle(t,language.title_conf_privacidade,"left"),l.classList.add("ico-privacy"),t.appendChild(l),t.addEventListener("click",()=>{let e={on(){t.setAttribute("active","on"),l.setAttribute("active",""),GFN.initTitle(t,language.title_conf_pivacidade_close,"left"),a.forEach(e=>{e.removeAttribute("tag")})},off(){t.setAttribute("active","off"),l.removeAttribute("active"),GFN.initTitle(t,language.title_conf_privacidade_open,"left"),a.forEach(e=>{e.setAttribute("tag","off")})}},a=document.querySelectorAll('.dropdown_content [dataID="privacy-content"]');"off"===t.getAttribute("active")?e.on():e.off()})},a=async()=>{let e={comChave(l,i){l.innerHTML=language.resetar_chave_titulo,i.classList.add("d-none");let n=document.createElement("button");n.innerHTML=language.resetar_chave_true,n.classList.add("true-btn"),t.appendChild(n),n.addEventListener("click",()=>{e.saveBackup(),e.removendo()});let s=document.createElement("button");s.innerHTML=language.resetar_chave_false,s.classList.add("false-btn"),t.appendChild(s),s.addEventListener("click",()=>{t.remove(),a()})},semChave(){document.querySelector("#allTitle").removeAttribute("data-show"),Swal.fire({title:language.resetar_chave_insiraChave,input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:language.resetar_chave,confirmButtonColor:"limegreen",showLoaderOnConfirm:!0,cancelButtonText:language.cancel,cancelButtonColor:"red",async preConfirm(e){let t=JSON.stringify({token:e});return await fetch(`${labelLink.license}/licenses/inactivate`,{method:"PUT",body:t,headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(async e=>{console.log(e),Swal.showValidationMessage(language.resetar_chave_remove)}).catch(e=>{Swal.showValidationMessage(`Request failed: ${e}`)})}}),t.remove(),a()},async removendo(){let t=await e.getLicense(),a=JSON.stringify({token:t});return await fetch(`${labelLink.license}/licenses/inactivate`,{method:"PUT",body:a,headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(async e=>{console.log(e),e?.succes&&(await chrome.storage.local.set({license:!1}),setTimeout(()=>{validateLicense(),init(),Swal.fire({title:language.resetar_chave_desativada,text:language.resetar_chave_removendo_text,icon:"warning",confirmButtonColor:"limegreen",confirmButtonText:"OK"})},1e3))})},getLicense:async()=>new Promise(e=>{chrome.storage.local.get("license",t=>{e(t.license)})}),async saveBackup(){chrome.storage.local.get(null,e=>{let t=JSON.stringify(e),a="data:text/plain;charset=utf-8,"+encodeURIComponent(t);window.postMessage({request:"watidyBackup",backup:a},"*")})}},t=document.createElement("div");t.classList.add("waTidy_notification_item"),t.style.alignItems="center",GFN.initTitle(t,language.resetar_chave_title,"left"),document.querySelectorAll('[dataid="privacy-content"]')[5].insertAdjacentElement("afterend",t);let l=document.createElement("p");l.innerHTML=language.resetar_chave_resetar,t.appendChild(l);let i=document.createElement("button");i.innerHTML=language.resetar,i.classList.add("resetar-chave"),t.appendChild(i),$(t).one("click",async()=>{e.comChave(l,i)})},l=()=>{let t=document.createElement("div");t.classList.add("waTidy_notification_item"),t.style.alignItems="center";let a=document.createElement("p");a.setAttribute("id","exportBtn"),a.innerText=language.export_data_label,a.addEventListener("click",exportData),t.appendChild(a);let l=document.createElement("div");l.classList.add("waTidy_notification_item"),l.style.alignItems="center",GFN.initTitle(l,language.chave_ativacao_title,"left"),e.appendChild(l);let i=document.createElement("p");i.innerHTML=language.chave_ativacao,l.appendChild(i);let n=document.createElement("img");GFN.showImg(n,"svgs/keyCopiar.svg"),n.classList.add("keyBtn"),l.appendChild(n),l.addEventListener("click",function(){chrome.storage.local.get("keyCopy",e=>{let t=e.keyCopy;GFN.textToClipboard(t)})});let s=document.createElement("div");s.classList.add("waTidy_notification_item"),s.style.alignItems="center";let d=document.createElement("p");d.setAttribute("id","importBtn"),d.innerText=`${language.import_data_label}`,d.addEventListener("click",importData);let r=document.createElement("p");r.innerHTML=V,r.style.display="inline-block",s.appendChild(d),s.appendChild(r),e.appendChild(t),e.appendChild(s)};e.innerHTML=`<div class="waTidy_notification_item" style="align-items: center;margin-top: 0.5em;">
                                <label for="lang">${language.language_label}</label>
                                <select style="width: 3em; text-align: center; background: var(--waTidy-dropdown-bg)" id="langSel">
                                    <option value="en" ${"en"==language.code?"selected":""}>EN</option>
                                    <option value="es" ${"es"==language.code?"selected":""}>ES</option>
                                    <option value="pt" ${"pt"==language.code?"selected":""}>PT</option>
                                </select>
    </div>`;let i=document.createElement("div");i.classList.add("waTidy_notification_item"),i.style.alignItems="center",i.style.marginTop="0.5em";let n=document.createElement("label");n.setAttribute("for","themeSetting"),n.innerText=language.theme_check_label;let s=document.createElement("label");s.classList.add("switch");let d=document.createElement("input");d.setAttribute("type","checkbox"),d.setAttribute("id","themeSetting"),d.addEventListener("change",()=>{document.body.classList.toggle("dark"),chrome.storage.local.set({darkMode:d.checked}),chrome.runtime.sendMessage({action:"themeReload",darkMode:d.checked})}),document.body.classList.contains("dark")&&(d.checked="checked");let r=document.createElement("span");r.classList.add("slider","round"),s.appendChild(d),s.appendChild(r),i.appendChild(n),i.appendChild(s),e.appendChild(i);let c=[language.privacy_allMsgs,language.privacy_lastMsg,language.privacy_mediaGallery,language.privacy_mediaPreview,language.privacy_names,language.privacy_profilePic],o=await readLocalStorage("privacySettings");t(e);let p=0;c.forEach(e=>{let t=document.createElement("div");t.setAttribute("tag","off"),t.setAttribute("dataID","privacy-content"),t.classList.add("waTidy_notification_item"),t.style.alignItems="center",t.style.marginTop="0.1em";let a=document.createElement("label");a.setAttribute("for",Object.keys(o)[p]),a.innerText=e;let l=document.createElement("label");l.classList.add("switch");let i=document.createElement("input");i.setAttribute("type","checkbox"),i.setAttribute("id",Object.keys(o)[p]),i.addEventListener("change",updatePrivacySettings),Object.values(o)[p]&&(i.checked="checked");let n=document.createElement("span");n.classList.add("slider","round"),l.appendChild(i),l.appendChild(n),t.appendChild(a),t.appendChild(l),document.querySelector('.waTidy_notification_item[tag="privacy"]').insertAdjacentElement("afterend",t),p++}),e.insertAdjacentHTML("beforeend",`<button id="upgradeBtn" class="waTidy_modal_button" style=" margin-bottom: 1em; margin-top: 0 !important;">${language.upgrade_btn_label}</button>`);let g=await GFN.isFree();g||a(),g||l(),setTimeout(()=>{document.querySelector("#langSel").addEventListener("change",changeLang),chrome.storage.local.get("license",e=>{e.license?document.querySelector("#upgradeBtn").remove():document.querySelector("#upgradeBtn").addEventListener("click",e=>{showActivateModal(e)})})},300)},initAddNewTab=async e=>{if(document.querySelector("#newTabInputContainer")){document.querySelector("#newTabInputContainer").remove();return}let t=document.querySelector(".tab_settings_container"),a=document.createElement("div");a.classList.add("settings_tab_container"),a.setAttribute("id","newTabInputContainer");let l=document.createElement("input");l.setAttribute("type","text"),l.classList.add("new_tab_input");let i=document.createElement("img");i.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/save.svg")),i.classList.add("save_btn","filter_white"),a.appendChild(l),a.appendChild(i),t.insertBefore(a,t.lastChild),l.focus(),i.addEventListener("click",e=>{e.stopPropagation();let t=l.value;if((t=t.normalize("NFD").replace(/([\u0300-\u036f]|[^0-9a-zA-Z\s])/g,"")).length){let i={tag:t,type:"user",chats:[]};chrome.storage.local.get("userTabs",e=>{let t=e.userTabs;if(t.some(e=>e.tag.toLowerCase()==i.tag.toLowerCase()))return;t.push(i);let a=localStorage.getItem("waTidy_tabs");localStorage.setItem("waTidy_tabs",`${a}|${i.tag}`),chrome.storage.local.set({userTabs:t},()=>{init()}),chrome.runtime.sendMessage({action:"abaAdd",aba:i})})}else a.remove()}),l.addEventListener("keydown",e=>{13===e.keyCode&&i.click()})},toggleTabVisibility=async(e,t,a,l)=>{let i="system"==a?await readLocalStorage("systemTabs"):await readLocalStorage("userTabs"),n="hide"==e;i.find(e=>e.tag==t).hide=n,"system"==a?chrome.storage.local.set({systemTabs:i}):chrome.storage.local.set({userTabs:i}),init()},updateTabName=async(e,t)=>{let a=await readLocalStorage("userTabs");a.find(t=>t.tag==e).tag=t,chrome.storage.local.set({userTabs:a},()=>init()),chrome.runtime.sendMessage({action:"abaUpdate",oldAba:e,newAba:t})},removeTab=async e=>{updatedTabs=(await readLocalStorage("userTabs")).filter(t=>t.tag!=e),chrome.storage.local.set({userTabs:updatedTabs},()=>init()),chrome.runtime.sendMessage({action:"abaRemove",aba:e})},showRemoveTabModal=e=>{let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.tab_delete_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.innerText=language.tab_delete_user_text;let s=document.createElement("button");s.innerText=language.delete,s.classList.add("waTidy_modal_button"),s.addEventListener("click",()=>removeTab(e));let d=document.createElement("button");d.innerText=language.cancel,d.classList.add("waTidy_modal_button"),d.addEventListener("click",()=>l.click());let r=document.createElement("div");r.style.display="flex",r.appendChild(d),r.appendChild(s),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(r),t.appendChild(a),document.body.appendChild(t)},injectTabSettingsDropdown=async e=>{let t=document.createElement("div");t.classList.add("tab_settings_container");let a=await readLocalStorage("systemTabs"),l=await readLocalStorage("userTabs"),i=document.createElement("div");i.classList.add("setting_tab_header","settings_tab_container");let n=document.createElement("p");n.innerText=language.tab_settings_heading;let s=document.createElement("span");s.innerText=language.tab_new_placeholder,s.addEventListener("click",initAddNewTab),i.appendChild(n),i.appendChild(s),t.appendChild(i),a.forEach(e=>{let a=document.createElement("div");a.classList.add("settings_tab_container");let l=document.createElement("p");l.innerText=language[e.tag];let i=document.createElement("div"),n=document.createElement("img"),s=e.hide?"tab_invisible":"tab_visible";n.setAttribute("src",chrome.runtime.getURL(`assets/images/svgs/${s}.svg`)),n.addEventListener("click",()=>{toggleTabVisibility(e.hide?"show":"hide",e.tag,"system",n)}),i.appendChild(n),a.appendChild(l),a.appendChild(i),t.appendChild(a)}),l.forEach(e=>{let a=document.createElement("div");a.classList.add("settings_tab_container");let l=document.createElement("p");l.innerText=e.tag;let i=document.createElement("div");i.setAttribute("style","display: flex;");let n=document.createElement("input");n.classList.add("new_tab_input"),n.setAttribute("value",e.tag),n.style.width="70%",n.style.marginRight="8px",n.style.display="none";let s=document.createElement("img");s.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/save.svg")),s.classList.add("save_btn","filter_white"),s.style.display="none",s.addEventListener("click",()=>{n.value=n.value.normalize("NFD").replace(/([\u0300-\u036f]|[^0-9a-zA-Z\s])/g,""),""==n.value.trim()||n.value.toLocaleLowerCase()==e.tag.toLowerCase()?(n.style.display="none",s.style.display="none",l.style.display="unset",d.style.display="unset",i.style.width="unset"):updateTabName(e.tag,n.value)}),n.addEventListener("keydown",e=>{13===e.keyCode&&s.click()});let d=document.createElement("img");d.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/tab_rename.svg")),d.addEventListener("click",e=>{e.stopPropagation(),l.style.display="none",d.style.display="none",n.style.display="unset",s.style.display="unset",i.style.width="100%"});let r=document.createElement("span");r.classList.add("delIcon"),GFN.svg(r,chrome.runtime.getURL("assets/images/svgs/tab_delete.svg")),r.addEventListener("click",()=>showRemoveTabModal(e.tag));let c=document.createElement("img"),o=e.hide?"tab_invisible":"tab_visible";c.setAttribute("src",chrome.runtime.getURL(`assets/images/svgs/${o}.svg`)),c.addEventListener("click",()=>{toggleTabVisibility(e.hide?"show":"hide",e.tag,"user",c)}),a.appendChild(l),i.appendChild(n),i.appendChild(s),i.appendChild(d),i.appendChild(r),i.appendChild(c),a.appendChild(i),t.appendChild(a)});let d=document.createElement("div");t.appendChild(d),e.appendChild(t)},injectDropdowns=(e,t)=>{t.classList.add("dropbtn");let a=document.createElement("div");switch(a.classList.add("dropdown_content"),t.getAttribute("for")){case"settings":injectMenuDropdown(a);break;case"edit_tabs":injectTabSettingsDropdown(a);break;case"notifications":injectRemindersDropdown(a)}t.addEventListener("click",()=>{closeDropDowns(a),a.classList.toggle("show"),"notifications"==t.getAttribute("for")&&injectRemindersDropdown(a)}),e.appendChild(a)},createNav=async e=>{chrome.storage.local.get("license",t=>{let a=document.createElement("button");t.license?a&&(a.style.display="none"):(a.classList.add("premium"),a.innerHTML=language.premium,e.appendChild(a),a.addEventListener("click",function(){window.open(labelLink.comprar,"_blank").focus()}))});(await readLocalStorage("menuItems")).forEach(t=>{let a=document.createElement("label");a.classList.add("menu_label"),a.setAttribute("for",generateSlug(t.id));let l=document.createElement("img"),i=chrome.runtime.getURL(`assets/images/svgs/${t.icon}.svg`);if(l.setAttribute("src",i),l.classList.add("filter_white"),"campaign"!=t.id&&injectDropdowns(e,a),"day_night_switch"==t.id&&l.addEventListener("click",e=>{document.body.classList.toggle("dark")}),"campaign"==t.id&&(GFN.initTitle(l,language.campanha,"bottom"),l.setAttribute("active","off"),l.setAttribute("tag","icoCampaign"),l.addEventListener("click",e=>{createCampaign(l)})),"edit_tabs"==t.id&&GFN.initTitle(l,language.edit_Tabs,"bottom"),"settings"==t.id&&GFN.initTitle(l,language.settings,"bottom"),"notifications"==t.icon){GFN.initTitle(l,language.notificacao,"bottom");let n=document.createElement("p");n.classList.add("noti"),a.appendChild(n),a.addEventListener("click",function(){n.style.display="none"})}a.appendChild(l),e.appendChild(a)});let t=chrome.runtime.getURL("assets/images/icons/youtube.png");e.insertAdjacentHTML("beforeend",`<label class="menu_label"><a href="${labelLink.tutoriais}" target="_blank"><img src="${t}" data="hoverTitle" class="menu_logo"></a></label>`),GFN.initTitle(document.querySelector('[data="hoverTitle"]'),language.videosTutorias,"bottom")},injectTopBar=async()=>{let e=await readLocalStorage("systemTabs"),t=await readLocalStorage("userTabs"),a=e.concat(t),l=document.createElement("div");l.classList.add("waTidy_container");let i=document.createElement("div");i.classList.add("waTidy_header");let n=document.createElement("div");n.classList.add("account_menu"),createNav(n),chrome.storage.local.get("license",e=>{e.license||(n.style.width="100%",n.style.marginLeft="0.6rem")});let s=document.querySelector("#app").children[0],d=s.querySelector("div");d.style.top="60px",d.style.height="calc(100% - 60px)";let r=document.createElement("div");r.classList.add("menu");let c=document.createElement("div");c.classList.add("waTidy_tooltips");let o=document.createElement("span");o.setAttribute("role","tooltip"),o.classList.add("popper"),o.setAttribute("id","allTitle"),c.appendChild(o),i.appendChild(r),i.appendChild(n),l.appendChild(i),null===document.querySelector(".waTidy_tooltips")&&document.body.prepend(c),s.appendChild(l),a.forEach(e=>{e.hide||("system"==e.type?injectSystemTab(e,r):injectUserTab(e,r))}),r.querySelector(".menu_input").checked=!0,setTimeout(()=>{let e=document.createElement("span");e.style.marginLeft="0.5em";let t=document.createElement("img"),a=chrome.runtime.getURL("assets/images/svgs/plus.svg");t.setAttribute("src",a),t.classList.add("filter_white"),GFN.initTitle(t,language.add_mais_aba,"bottom"),t.style.height="23px",t.style.cursor="pointer",t.addEventListener("click",e=>{e.stopPropagation(),document.querySelector("label[for='edit_tabs']").click(),document.querySelector(".setting_tab_header > span").click()}),e.appendChild(t),r.appendChild(e)},300)},showModalErr=(e,t)=>{document.querySelector(".waTidy_modal_success")?.remove(),document.querySelector(".waTidy_modal_err")?.remove();let a=document.createElement("p");a.classList.add("waTidy_modal_err"),!0===t&&a.classList.add("watidy_campanha_err"),a.innerText=language[e]||e;let l=document.querySelector(".waTidy_modal_label")||document.querySelector(".waTidy_modal_desc");l.parentNode.insertBefore(a,l)},showModalSuccess=e=>{document.querySelector(".waTidy_modal_err")?.remove(),document.querySelector(".waTidy_modal_success")?.remove();let t=document.createElement("p");t.classList.add("waTidy_modal_success"),t.innerText=language[e]||e;let a=document.querySelector(".waTidy_modal_label");a.parentNode.insertBefore(t,a)},initiateNewChat=e=>{chrome.storage.local.get("license",e=>{e.license?t():chrome.storage.local.get("initChat",e=>{let a=new Date,l=String(a.getDate()).padStart(2,"0"),i,n=`${String(a.getMonth()+1).padStart(2,"0")}/${l}/${a.getFullYear()}`,s={dataHj:n,enviados:1};if(void 0==e.initChat)chrome.storage.local.set({initChat:s},()=>{init()}),t();else{var d,r,c=new Date(e.initChat.dataHj),o=Math.abs(new Date(n)-c)/864e5,p=e.initChat.dataHj,g=e.initChat.enviados;if(0==o){if(++g<=5)t();else{let u="#modalNewChat",m=language.newChatFree;GFN.modalPremium(u,m)}}else p=n,g=1,t();let h={dataHj:p,enviados:g};chrome.storage.local.set({initChat:h}),console.log(e),console.log(e.initChat.dataHj)}})});async function t(){let e=document.querySelector("#waTidy_new_chat_number"),t=document.querySelector("#waTidy_new_chat_cc");if(t.value.length){if(e.value.length){let a=document.querySelector("#saveName"),l=t.value+e.value;if(l=l.replaceAll(" ","").replaceAll("-","").replaceAll("(","").replaceAll(")",""),0!==a.value.length){let i={id:l,name:a.value},n=await readLocalStorage("contatos");if(await GFN.isFree()&&n.length>5){modal?.remove(),GFN.modalPremium(!1,language.saveCts_free);return}console.log(i),window.postMessage({request:"save_editContato",contato:i},"*"),(n=n.filter(e=>e.id!=l)).push(i),chrome.storage.local.set({contatos:n})}let s=document.createElement("a");s.setAttribute("href",`https://api.whatsapp.com/send?phone=${l}`);let d=document.body.appendChild(s);d.click(),d.remove()}else showModalErr("start_chat_number_error")}else showModalErr("start_chat_country_code_error")}},showNewChatModal=e=>{e.stopPropagation();let t=document.createElement("div");t.setAttribute("id","modalNewChat"),t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.start_chat_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.innerText=language.start_chat_text;let s=document.createElement("p");s.classList.add("waTidy_modal_label"),s.innerText=language.start_chat_number_title;let d=document.createElement("datalist");d.setAttribute("id","waTidy_country_codes"),chrome.storage.local.get("ccList",e=>{e.ccList.forEach(e=>{let t=document.createElement("option");t.setAttribute("label",e.label),t.setAttribute("value",e.code),d.appendChild(t)})});let r=document.createElement("input");r.setAttribute("id","waTidy_new_chat_cc"),r.setAttribute("list","waTidy_country_codes"),r.classList.add("waTidy_modal_cc_input","waTidy_modal_input");let c=document.createElement("input");c.setAttribute("type","text"),c.setAttribute("id","waTidy_new_chat_number"),c.setAttribute("placeholder",language.start_chat_number_placeholder),c.classList.add("waTidy_modal_number_input","waTidy_modal_input");let o=document.createElement("div");o.classList.add("waTidy_number_input_container"),o.appendChild(r),o.appendChild(c);let p=document.createElement("p");p.classList.add("waTidy_modal_label"),p.innerText=language.name_aSalvar,p.style.padding="1.5rem 0 1.1rem 0";let g=document.createElement("input");g.setAttribute("id","saveName"),g.classList.add("waTidy_modal_input"),g.style.width="91%",g.placeholder=language.reminder_title;let u=document.createElement("button");u.innerText=language.start_chat_btn_text,u.classList.add("waTidy_modal_button"),u.addEventListener("click",initiateNewChat),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(s),a.appendChild(d),a.appendChild(o),a.appendChild(p),a.appendChild(g),a.appendChild(u),t.appendChild(a),document.body.appendChild(t)},exportContactsInTab=()=>{chrome.storage.local.get("userTabs",e=>{window.postMessage({message:"getCurrentTabChats",userTabsForExport:e.userTabs},"*")})},showCreateLinkModal=e=>{e.stopPropagation();let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.create_link_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.innerText=language.create_link_caption;let s=document.createElement("p");s.classList.add("waTidy_modal_label"),s.innerText=language.create_link_number_label;let d=document.createElement("datalist");d.setAttribute("id","waTidy_country_codes"),chrome.storage.local.get("ccList",e=>{e.ccList.forEach(e=>{let t=document.createElement("option");t.setAttribute("label",e.label),t.setAttribute("value",e.code),d.appendChild(t)})});let r=document.createElement("input");r.setAttribute("id","waTidy_new_chat_cc"),r.setAttribute("list","waTidy_country_codes"),r.classList.add("waTidy_modal_cc_input","waTidy_modal_input");let c=document.createElement("input");c.setAttribute("type","text"),c.setAttribute("id","waTidy_new_chat_number"),c.setAttribute("placeholder",language.start_chat_number_placeholder),c.classList.add("waTidy_modal_number_input","waTidy_modal_input");let o=document.createElement("div");o.classList.add("waTidy_number_input_container"),o.appendChild(r),o.appendChild(c);let p=document.createElement("p");p.classList.add("waTidy_modal_label"),p.innerText=language.create_link_message_label;let g=document.createElement("input");g.setAttribute("type","text"),g.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input"),g.setAttribute("placeholder",language.create_link_message_placeholder);let u=document.createElement("p");u.classList.add("waTidy_generated_link"),u.style.display="none";let m=document.createElement("button");m.innerText=language.create_link_btn_text,m.classList.add("waTidy_modal_button"),m.addEventListener("click",()=>{if(r.value.length){if(c.value.length){if(g.value.length){let e=`https://wa.me/+${r.value}${c.value}?text=${encodeURIComponent(g.value)}`;u.style.display="block",u.innerText=e,navigator.clipboard.writeText(e),showModalSuccess("create_link_copied_message")}else showModalErr("create_link_message_error")}else showModalErr("start_chat_number_error")}else showModalErr("start_chat_country_code_error")}),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(s),a.appendChild(d),a.appendChild(o),a.appendChild(p),a.appendChild(g),a.appendChild(u),a.appendChild(m),t.appendChild(a),document.body.appendChild(t)},injectUtilButtons=()=>{let e=document.querySelector("div._604FD > ._2XdMx._1sPvB > span"),t=document.createElement("div");t.classList.add("_3OtEr");let a=document.createElement("div");a.classList.add("_3ndVb");let l=document.createElement("span");l.style.height="28px";let i=document.createElement("img");i.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/contatos.svg")),GFN.initTitle(i,language.campain_types5,"bottom"),i.classList.add("new_chat_btn","filter_white"),i.style.filter="var(--filerIcoMain)",i.style.width="25px",l.appendChild(i),a.appendChild(l),t.appendChild(a),e.prepend(t);let n=document.createElement("div");n.classList.add("_3OtEr"),n.id="menuPlusContainer",n.addEventListener("click",e=>{p(e)}),e.prepend(n);let s=document.createElement("div");s.classList.add("_3ndVb"),n.appendChild(s),GFN.initTitle(n,language.maisOp_Title,"bottom");let d=document.createElement("span");d.classList.add("menuPlusIco"),s.appendChild(d),GFN.svg(d,chrome.runtime.getURL("assets/images/svgs/menuPlus.svg"));let r=document.createElement("div");GFN.initTitle(r,"CRM Kanban","bottom"),r.classList.add("_3OtEr"),r.addEventListener("click",()=>{chrome.runtime.sendMessage({message:"modoCRM"})}),e.prepend(r);let c=document.createElement("div");c.classList.add("_3ndVb"),r.appendChild(c);let o=document.createElement("span");function p(e){n.classList.add("menuPlusActive"),document.querySelector("#menuPlus")?.remove(),e.stopPropagation();let t=document.createElement("span");t.setAttribute("role","tooltip"),t.id="menuPlus",t.setAttribute("data-show",""),t.classList.add("popper"),t.style.background="none",document.querySelector(".waTidy_tooltips").appendChild(t),Popper.createPopper(s,t,{placement:"bottom",modifiers:[{name:"offset",options:{offset:[0,-5]}},]});let a=document.createElement("div");a.setAttribute("style","position: initial"),a.classList.add("_2sDI2","_1b6oD"),t.appendChild(a);let l=document.createElement("ul");l.classList.add("_3bcLp"),a.appendChild(l);let i=document.createElement("div");i.classList.add("ocd2b0bc","aa0kojfi"),l.appendChild(i);let d=[language.start_chat_heading,language.create_link_title,"Driver online",language.export_contacts_title,language.campanha],r=0;["start_chat.svg","create_link.svg","drive.svg","export_contacts.svg","campaign.svg"].forEach(e=>{let a=document.createElement("div");a.classList.add("bugiwsl0","fooq7fky"),i.appendChild(a);let l=document.createElement("li");l.setAttribute("style","opacity: 1;"),l.classList.add("jScby","Iaqxu","FCS6Q","_2UNQo"),a.appendChild(l);let s=document.createElement("div");s.setAttribute("class","tvf2evcx m0h2a7mj lb5m6g5c j7l1k36l ktfrpxia nu7pwgvd dnb887gk gjuq5ydh i2cterl7 p357zi0d fhf7t426 sap93d0t gndfcl4n ajgl1lbb lniyxyh2 fooq7fky bcfko8ch"),l.appendChild(s);let c=document.createElement("div");c.setAttribute("class","tvf2evcx m0h2a7mj lb5m6g5c j7l1k36l tw2komxm nu7pwgvd dnb887gk gjuq5ydh i2cterl7 p357zi0d ac2vgrno sap93d0t r15c9g6i oz083wsx menuPlusIcoList"),GFN.svg(c,chrome.runtime.getURL(`assets/images/svgs/${e}`)),s.appendChild(c);let o=document.createElement("span");switch(o.setAttribute("class","erpdyial tviruh8d gfz4du6o r7fjleex lhj4utae le5p0ye3"),o.setAttribute("style","font-size: 16px;"),o.innerHTML=d[r],s.appendChild(o),e){case"start_chat.svg":a.addEventListener("click",e=>{n?.classList.remove("menuPlusActive"),t?.remove(),showNewChatModal(e)});break;case"create_link.svg":a.addEventListener("click",e=>{n?.classList.remove("menuPlusActive"),t?.remove(),showCreateLinkModal(e)});break;case"drive.svg":a.addEventListener("click",e=>{n?.classList.remove("menuPlusActive"),t?.remove(),window.postMessage({request:"chatAtendentes"},"*")});break;case"export_contacts.svg":a.addEventListener("click",e=>{n?.classList.remove("menuPlusActive"),t?.remove(),chrome.storage.local.get("license",e=>{if(e.license)exportContactsInTab();else{let t=language.exportContats;GFN.modalPremium(!1,t)}})});break;case"campaign.svg":c.classList.add("campainIco"),a.addEventListener("click",()=>{n?.classList.remove("menuPlusActive"),t?.remove(),createCampaign(document.querySelector('img[tag="icoCampaign"]'))})}r++})}o.classList.add("menuIcoKanban"),o.style.height="28px",c.appendChild(o),GFN.svg(o,chrome.runtime.getURL("assets/images/svgs/crm.svg"));let g=setInterval(()=>{let e=document.querySelector("div._2XdMx._1sPvB");e&&initWatidyContacts(g,t)})},injectChatScripts=()=>{let e=["assets/js/chat.js","assets/libs/wpp.js","assets/libs/jquery.js","assets/js/globalFunctions.js","assets/libs/sweetalert2.js","assets/js/campaign_back.js","assets/js/wppRequest.js","assets/libs/controler.js","assets/libs/snap.svg-min.js","assets/libs/hyperHtml.js",];Promise.all(e.map(e=>{let t=document.createElement("script");return t.src=chrome.runtime.getURL(e),t.onload=function(){this.remove()},new Promise((e,a)=>{t.onerror=a,(document.head||document.documentElement).appendChild(t),e()})})).catch(e=>{console.error("Failed to load scripts:",e)});let t=document.createElement("div");t.setAttribute("id",chrome.runtime.id),t.setAttribute("class","waTidyIDContainer"),t.style.display="none",document.body.appendChild(t)},initSortable=()=>{let e=document.querySelector(".menu");Sortable.create(e,{draggable:".menu_item",filter:".editTabMenu",group:"waTidy_tabs",animation:100,easing:"cubic-bezier(1, 0, 0, 1)",store:{get:function(e){let t=localStorage.getItem(e.options.group.name);return t?t.split("|"):[]},set:function(e){let t=e.toArray();localStorage.setItem(e.options.group.name,t.join("|"))}}}).save()},init=async()=>{chrome.runtime.sendMessage({message:"getLanguageURI"},function(e){fetch(e).then(e=>e.json()).then(e=>{language=e,window.postMessage({request:"language",language:language},"*"),GFN.Wpp_Request("loadPictureChat");let t=!1;document.querySelector(".waTidy_container")&&(t=document.querySelector('input[name="menu"]:checked').dataset.tag,document.querySelector(".waTidy_container").remove()),injectTopBar(),window.postMessage({action:"isBusines"},"*"),t?resetQuickActionButtons():injectUtilButtons(),waitForEl(".menu",()=>{t&&(document.querySelector(`[data-tag="${t}"]`)?document.querySelector(`[data-tag="${t}"]`).click():document.querySelector(".menu_label").click()),initSortable()}),setTimeout(()=>{GFN.assAtivo=!1,GFN.saveAtivo=!1},1100)})}),window.postMessage({action:"initWatidyContacts"},"*");let e=async()=>{let e={nome:null};await Swal.fire({icon:"info",title:language.Atencao,text:language.init_alert_msg,confirmButtonColor:"limegreen"}),chrome.storage.local.set({assinatura:e}),modalAssinar(!0)};void 0===(await readLocalStorage("assinatura")).nome&&e(),chrome.storage.local.get("darkMode",e=>{void 0==e.darkMode&&chrome.storage.local.set({darkMode:[]}),!0===e.darkMode?document.body.classList.add("dark"):document.body.classList.remove("dark"),darkMode=e.darkMode})};waitForEl("#pane-side",()=>{injectChatScripts();let e=document.querySelector("#pane-side");e.scrollTo(0,e.scrollHeight),setTimeout(()=>{e.scrollTo(e.scrollHeight,0),saveContctsInit()},500)});const addChatToTabs=()=>{window.postMessage({message:"getActiveID"},"*")},showAddToTabModal=async e=>{e.stopPropagation();let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.add_to_tab_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.innerText=language.add_to_tab_text;let s=document.createElement("div");s.classList.add("waTidy_chats_list");let d=document.createElement("ul"),r=await readLocalStorage("userTabs");window.postMessage({message:"getActiveIDForModal"},"*");let c=[];r.forEach(e=>{let t=document.createElement("li");t.setAttribute("title",e.tag);let a=document.createElement("div");a.classList.add("item-container");let l=document.createElement("span");l.classList.add("check"),l.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true">
                            <path d="M6 12L10.25 17L19 8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
                        </svg>`;let i=document.createElement("label");i.innerText=e.tag,a.appendChild(l),a.appendChild(i);let n=document.createElement("div");n.classList.add("separator"),t.appendChild(a),t.appendChild(n),t.addEventListener("click",()=>{t.classList.toggle("active"),l.classList.toggle("active")});let s=setInterval(()=>{""!=activeID&&(e.chats.includes(activeID)&&(t.classList.add("active"),l.classList.add("active")),clearInterval(s))},100);c.push(t)}),setTimeout(()=>{let e,t=document.createDocumentFragment(),a=document.createDocumentFragment();for(e=0;e<c.length;e++)c[e].classList.contains("active")?t.appendChild(c[e]):a.appendChild(c[e]);d.append(t),d.append(a)},120),activeID="",s.appendChild(d);let o=document.createElement("button");o.innerText=language.save,o.classList.add("waTidy_modal_button"),o.addEventListener("click",()=>{chrome.storage.local.get("license",e=>{if(e.license)addChatToTabs();else if(!0===p()){let t=".waTidy_modal",a=language.selecionar5NaFree;GFN.modalPremium(t,a)}else addChatToTabs()})});let p=()=>{let e=!1;return c.forEach(t=>{"active"==t.classList.value&&r.forEach(a=>{a.tag===t.title&&a.chats.length>=5&&(e=!0)})}),e};a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(s),a.appendChild(o),t.appendChild(a),document.body.appendChild(t)},getTimezoneOffset=()=>{let e=e=>(e<10?"0":"")+e;var t=new Date().getTimezoneOffset(),a=t<0?"+":"-";return t=Math.abs(t),a+e(t/60|0)+e(t%60)},addNotification=async e=>{if(!await validateLicense("notifications")){showUpgradeModal(e);return}let t=document.querySelector("#waTidy_reminder_date").value,a=document.querySelector("#waTidy_reminder_time").value,l=document.querySelector("#waTidy_reminder_title").value,i=document.querySelector("#waTidy_reminder_calendar").checked,n=new Date,s=`${t}T${a}:00${getTimezoneOffset()}`,d=new Date(s);if(n>=d){showModalErr("Please enter a date and time in the future");return}if(""==l.trim()){showModalErr("Please enter title");return}window.postMessage({message:"getActiveIDForReminder"},"*");let r=await readLocalStorage("notifications"),c=setInterval(()=>{if(""!=activeID){let e={id:Date.now(),read:!1,title:l,date:t,time:a,user_id:activeID};r.push(e),chrome.storage.local.set({notifications:r},()=>{activeID="",document.body.click(),clearInterval(c)})}},100);if(i){let o=`${t}T${a}:00${getTimezoneOffset()}`,p="https://calendar.google.com/calendar/render?action=TEMPLATE&text=";p+=`${encodeURIComponent(l)}&dates=${o.replace(RegExp("[-:+]","g"),"")}/${o.replace(RegExp("[-:+]","g"),"")}`,chrome.runtime.sendMessage({message:"openLink",link:p})}},showAddReminderModal=e=>{e.stopPropagation();let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content");let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.reminder_create_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.style.fontSize="14px",n.innerText=language.reminder_create_text;let s=document.createElement("p");s.classList.add("waTidy_modal_label"),s.innerText=language.reminder_title;let d=document.createElement("input");d.setAttribute("type","text"),d.setAttribute("id","waTidy_reminder_title");let r=document.querySelector('span[data-testid="conversation-info-header-chat-title"]').innerText;d.value=language.reminder_title_placeholder+" "+r,d.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let c=document.createElement("p");c.classList.add("waTidy_modal_label"),c.innerText=language.reminder_date;let o=new Date;o.setMinutes(o.getMinutes()+5);let p=10>o.getDate()?"0"+o.getDate():o.getDate(),g=o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1,u=o.getFullYear(),m=10>o.getHours()?"0"+o.getHours():o.getHours(),h=10>o.getMinutes()?"0"+o.getMinutes():o.getMinutes(),v=`${u}-${g}-${p}`,y=`${m}:${h}`,b=document.createElement("input");b.setAttribute("type","date"),b.setAttribute("id","waTidy_reminder_date"),b.setAttribute("min",v),b.value=v,b.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let _=document.createElement("p");_.classList.add("waTidy_modal_label"),_.innerText=language.reminder_time;let w=document.createElement("input");w.setAttribute("type","time"),w.setAttribute("id","waTidy_reminder_time"),w.setAttribute("value",y),w.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let T=document.createElement("input");T.setAttribute("type","checkbox"),T.setAttribute("id","waTidy_reminder_calendar"),T.classList.add("waTidy_modal_label");let L=document.createElement("label");L.setAttribute("for","waTidy_reminder_calendar"),L.innerText=language.reminder_calendar,L.style.marginLeft="0.5em";let E=document.createElement("button");E.innerText=language.save,E.classList.add("waTidy_modal_button"),E.addEventListener("click",addNotification);let C=document.createElement("button");C.innerText=language.cancel,C.classList.add("waTidy_modal_button"),C.addEventListener("click",()=>l.click());let f=document.createElement("div");f.style.display="flex",f.appendChild(C),f.appendChild(E),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(s),a.appendChild(d),a.appendChild(c),a.appendChild(b),a.appendChild(_),a.appendChild(w),a.appendChild(T),a.appendChild(L),a.appendChild(f),t.appendChild(a),document.body.appendChild(t)},copyNote=async(e,t)=>{let a=await readLocalStorage("notes"),l=(a=a.filter(t=>t.id==e))[0].text;GFN.textToClipboard(l)},delNote=async(e,t)=>{let a=await readLocalStorage("notes");if(a=a.filter(t=>t.id!=e.id),chrome.storage.local.set({notes:a},()=>{t.remove()}),0==a.length){let l=document.querySelector(".waTidy_notes_container"),i=document.createElement("div");i.setAttribute("id","notesEmptyMsg"),i.style.textAlign="center";let n=document.createElement("p");n.innerText=language.notes_empty,i.appendChild(n),l.appendChild(i)}GFN.tabsAtualize.updateUser(!1),chrome.runtime.sendMessage({action:"updateContNotas",userID:e.userID})},addNote=async(e,t)=>{if(!await validateLicense("notes")){let a="#modalShowNote",l=language.showNoteFree;GFN.modalPremium(a,l);return}let i=document.querySelector("#waTidy_note"),n=i.value;if(""==n.trim())return;let s=await readLocalStorage("notes"),d={id:Date.now(),userID:t,text:n};s.push(d),chrome.storage.local.set({notes:s},()=>{i.value="",document.querySelector("#notesEmptyMsg")?.remove();let e=document.querySelector(".waTidy_notes_container"),t=document.createElement("div");t.classList.add("waTidy_note_item");let a=document.createElement("p");a.innerText=d.text;let l=document.createElement("span"),n=new Date(d.id),s=`${n.toLocaleDateString()} at ${n.toLocaleTimeString()}`;l.innerText=s;let r=document.createElement("div");r.setAttribute("style","margin-left: 0.3rem;display: flex;}");let c=document.createElement("span");GFN.svg(c,chrome.runtime.getURL("assets/images/svgs/tab_delete.svg")),c.addEventListener("click",()=>delNote(d,t)),c.style.cursor="pointer";let o=document.createElement("img");o.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/fileCopy.svg")),o.addEventListener("click",()=>copyNote(d.id,t)),o.classList.add("copy"),r.appendChild(o),r.appendChild(c),a.appendChild(l),t.appendChild(a),t.appendChild(r),e.prepend(t)}),GFN.tabsAtualize.updateUser(!1),chrome.runtime.sendMessage({action:"updateContNotas",userID:t})},showNotesModal=async e=>{e.stopPropagation();let t=document.createElement("div");t.setAttribute("id","modalShowNote"),t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content"),a.style.width="45rem";let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.notes;let n=document.createElement("p");n.classList.add("waTidy_modal_desc"),n.style.fontSize="14px",n.innerText=language.note_placeholder;let s=document.createElement("div");s.classList.add("waTidy_notes_container");let d="";window.postMessage({message:"getActiveIDForNote"},"*");let r=await readLocalStorage("notes"),c=setInterval(()=>{if(""!=activeID){d=activeID,console.log(activeID);let e=r.filter(e=>e.userID==activeID).reverse();if(0==e.length){let t=document.createElement("div");t.setAttribute("id","notesEmptyMsg"),t.style.textAlign="center";let a=document.createElement("p");a.innerText=language.notes_empty,t.appendChild(a),s.appendChild(t)}else e.forEach(e=>{let t=document.createElement("div");t.classList.add("waTidy_note_item");let a=document.createElement("p");a.innerText=e.text;let l=document.createElement("span"),i=new Date(e.id),n=`${i.toLocaleDateString()} at ${i.toLocaleTimeString()}`;l.innerText=n;let d=document.createElement("div");d.setAttribute("style","margin-left: 0.3rem;display: flex;}");let r=document.createElement("span");GFN.svg(r,chrome.runtime.getURL("assets/images/svgs/tab_delete.svg")),r.addEventListener("click",()=>delNote(e,t)),r.style.cursor="pointer";let c=document.createElement("img");c.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/fileCopy.svg")),c.addEventListener("click",()=>copyNote(e.id,t)),c.classList.add("copy"),d.appendChild(c),d.appendChild(r),a.appendChild(l),t.appendChild(a),t.appendChild(d),s.appendChild(t)});clearInterval(c),activeID=""}},100),o=document.createElement("textarea");o.setAttribute("id","waTidy_note"),o.classList.add("waTidy_modal_input","waTidy_note_input");let p=document.createElement("button");p.innerText=language.save,p.classList.add("waTidy_modal_button","waTidy_note_btn"),p.addEventListener("click",e=>addNote(e,d)),a.appendChild(l),a.appendChild(i),a.appendChild(s),a.appendChild(n),a.appendChild(o),a.appendChild(p),t.appendChild(a),document.body.appendChild(t)},showCreateEventModal=async e=>{e.stopPropagation();let t=document.createElement("div");t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content"),a.style.width="35rem";let l=document.createElement("button");l.classList.add("waTidy_modal_close_btn"),l.addEventListener("click",()=>{t.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerText=language.event_model_heading;let n=document.createElement("p");n.classList.add("waTidy_modal_label"),n.innerText=language.event_title_label;let s=document.createElement("input");s.setAttribute("type","text"),s.setAttribute("id","waTidy_event_title"),s.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let d=new Date;d.setMinutes(d.getMinutes()+5);let r=10>d.getDate()?"0"+d.getDate():d.getDate(),c=d.getMonth()+1<10?"0"+(d.getMonth()+1):d.getMonth()+1,o=d.getFullYear(),p=10>d.getHours()?"0"+d.getHours():d.getHours(),g=10>d.getMinutes()?"0"+d.getMinutes():d.getMinutes(),u=`${o}-${c}-${r}`,m=`${p}:${g}`,h=document.createElement("div");h.classList.add("waTidy_dateTime_field");let v=document.createElement("p");v.classList.add("waTidy_modal_label"),v.innerText=language.event_from_label;let y=document.createElement("input");y.setAttribute("type","date"),y.setAttribute("id","waTidy_event_from_date"),y.setAttribute("min",u),y.value=u,y.classList.add("waTidy_modal_input","waTidy_textArea");let b=document.createElement("input");b.setAttribute("type","time"),b.setAttribute("id","waTidy_event_from_time"),b.setAttribute("value",m),b.classList.add("waTidy_modal_input","waTidy_textArea"),h.appendChild(y),h.appendChild(b);let _=document.createElement("div");_.classList.add("waTidy_dateTime_field");let w=document.createElement("p");w.classList.add("waTidy_modal_label"),w.innerText=language.event_to_label;let T=document.createElement("input");T.setAttribute("type","date"),T.setAttribute("id","waTidy_event_to_date"),T.setAttribute("min",u),T.value=u,T.classList.add("waTidy_modal_input","waTidy_textArea");let L=document.createElement("input");L.setAttribute("type","time"),L.setAttribute("id","waTidy_event_to_time"),L.setAttribute("value",m),L.classList.add("waTidy_modal_input","waTidy_textArea"),_.appendChild(T),_.appendChild(L);let E=document.createElement("p");E.classList.add("waTidy_modal_label"),E.innerText=language.event_location_label;let C=document.createElement("input");C.setAttribute("type","text"),C.setAttribute("id","waTidy_event_location"),C.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let f=document.createElement("p");f.classList.add("waTidy_modal_label"),f.innerText=language.event_description_label;let A=document.createElement("input");A.setAttribute("type","text"),A.setAttribute("id","waTidy_event_desc"),A.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let x=document.createElement("button");x.innerText=language.save,x.classList.add("waTidy_modal_button"),x.addEventListener("click",async e=>{if(!await validateLicense("events")){showUpgradeModal(e);return}let t=s.value,a=A.value.trim()||"",l=C.value.trim()||"",i,n=`${y.value}T${b.value}:00${getTimezoneOffset()}`,d=new Date(n),r,c=`${T.value}T${L.value}:00${getTimezoneOffset()}`,o=new Date(c);if(""==t.trim()){showModalErr("event_empty_title_error");return}if(d>=o){showModalErr("event_date_error");return}let p="https://calendar.google.com/calendar/render?action=TEMPLATE&text=",g=`${language.event_link_msg} ${p+=`${encodeURIComponent(t)}&dates=${n.replace(RegExp("[-:+]","g"),"")}/${c.replace(RegExp("[-:+]","g"),"")}&details=${encodeURIComponent(a)}&location=${encodeURIComponent(l)}`} - ${language.event_link_powered_by}`;document.body.click(),setTimeout(()=>{var e=document.querySelector("#main [contenteditable~=true]");e.innerHTML=g,e.dispatchEvent(new Event("input",{bubbles:!0}))},300),chrome.storage.local.get("events",e=>{let i=e.events,s={title:t,from:n,to:c,description:a,location:l};i.push(s),chrome.storage.local.set({events:i})}),chrome.runtime.sendMessage({message:"openLink",link:p})}),a.appendChild(l),a.appendChild(i),a.appendChild(n),a.appendChild(s),a.appendChild(v),a.appendChild(h),a.appendChild(w),a.appendChild(_),a.appendChild(E),a.appendChild(C),a.appendChild(f),a.appendChild(A),a.appendChild(x),t.appendChild(a),document.body.appendChild(t)},copyAgenda=async(e,t)=>{let a=await readLocalStorage("agendaMsg"),l=(a=a.filter(t=>t.id==e))[0].text;GFN.textToClipboard(l)},delAgenda=async(e,t)=>{let a=await readLocalStorage("agendaMsg");if(a=a.filter(t=>t.id!=e.id),chrome.storage.local.set({agendaMsg:a},()=>{t.remove()}),0==a.length){let l=document.querySelector(".waTidy_agenda_container"),i=document.createElement("div");i.setAttribute("id","notesEmptyMsg"),i.style.textAlign="center";let n=document.createElement("p");n.innerText=language.notes_empty,i.appendChild(n),l.appendChild(i)}GFN.tabsAtualize.updateUser(!1),chrome.runtime.sendMessage({action:"updateContNotas",userID:e.userID})},addAgenda=async(e,t,a)=>{if(!await validateLicense("agendaMsg")){let l="#modalShowAgendar",i=language.showAgendarFree;GFN.modalPremium(l,i);return}let n=document.querySelector("#waTidy_agenda"),s=n.value,d=document.querySelector("#dataInput").value,r=document.querySelector("#timerInput").value;if(""==s.trim())return;let c=await readLocalStorage("agendaMsg"),o={id:Date.now(),userID:t,text:s,data:d,timer:r};c.push(o),chrome.storage.local.set({agendaMsg:c},()=>{n="",document.querySelector("#agendaEmptyMsg")?.remove();let e=document.querySelector(".waTidy_agenda_container"),t=document.createElement("div");t.classList.add("waTidy_note_item");let l=document.createElement("p");l.style.textAlign="start",l.innerText=o.text;let i=document.createElement("span"),s=new Date(o.data);s.setDate(s.getDate()+1);let d=String(s.getDate()).padStart(2,"0"),r,c=`${d}/${String(s.getMonth()+1).padStart(2,"0")}/${s.getFullYear()} at ${o.timer}`;i.innerText=c;let p=document.createElement("div");p.setAttribute("style","margin-left: 0.3rem;display: flex;}");let g=document.createElement("span");GFN.svg(g,chrome.runtime.getURL("assets/images/svgs/tab_delete.svg")),g.addEventListener("click",()=>delAgenda(o,t)),g.style.cursor="pointer";let u=document.createElement("img");u.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/fileCopy.svg")),u.addEventListener("click",()=>copyAgenda(o.id,t)),u.classList.add("copy"),a.style.display="block",p.appendChild(u),p.appendChild(g),l.appendChild(i),t.appendChild(l),t.appendChild(p),e.prepend(t)}),GFN.tabsAtualize.updateUser(!1),chrome.runtime.sendMessage({action:"updateContNotas",userID:t})},showAgendarMsg=async e=>{e.stopPropagation();let t=document.createElement("div");t.setAttribute("id","modalShowAgendar"),t.classList.add("waTidy_modal");let a=document.createElement("div");a.classList.add("waTidy_modal_content"),a.style.width="55rem";let l=document.createElement("div");l.classList.add("gridAgendar");let i=document.createElement("div");i.classList.add("showAgenda");let n=document.createElement("div");n.classList.add("showAgendados"),n.style.textAlign="center";let s=document.createElement("h1");s.innerHTML=language.msgAgendadas,s.classList.add("waTidy_modal_heading"),s.style.paddingBottom="0.7rem";let d=document.createElement("button");d.classList.add("waTidy_modal_close_btn"),d.addEventListener("click",()=>{t.remove()});let r=document.createElement("h1");r.classList.add("waTidy_modal_heading"),r.style.display="block",r.style.textAlign="center",r.innerText=language.agenda;let c=document.createElement("p");c.classList.add("waTidy_modal_agendar"),c.innerText=language.agendaDesc;let o=document.createElement("div");o.classList.add("waTidy_agenda_container");let p=document.createElement("p");p.innerHTML=language.agendarMsg_alert,p.style.marginTop="0.5rem",p.style.display="none";let g="";window.postMessage({message:"getActiveIDForNote"},"*");let u=await readLocalStorage("agendaMsg"),m=setInterval(()=>{if(""!=activeID){g=activeID;let e=u.filter(e=>e.userID==activeID).reverse();if(0==e.length){let t=document.createElement("div");t.setAttribute("id","agendaEmptyMsg");let a=document.createElement("p");a.innerText=language.agenda_empty,t.appendChild(a),o.appendChild(t)}else e.forEach(e=>{let t=document.createElement("div");t.classList.add("waTidy_note_item");let a=document.createElement("p");a.style.textAlign="start",a.innerText=e.text;let l=document.createElement("span"),i=new Date(e.data);i.setDate(i.getDate()+1);let n=String(i.getDate()).padStart(2,"0"),s,d=`${n}/${String(i.getMonth()+1).padStart(2,"0")}/${i.getFullYear()} at ${e.timer}`;l.innerText=d;let r=document.createElement("div");r.setAttribute("style","margin-left: 0.3rem;display: flex;}");let c=document.createElement("span");GFN.svg(c,chrome.runtime.getURL("assets/images/svgs/tab_delete.svg")),c.addEventListener("click",()=>delAgenda(e,t)),c.style.cursor="pointer";let g=document.createElement("img");g.setAttribute("src",chrome.runtime.getURL("assets/images/svgs/fileCopy.svg")),g.addEventListener("click",()=>copyAgenda(e.id,t)),g.classList.add("copy"),p.style.display="block",r.appendChild(g),r.appendChild(c),a.appendChild(l),t.appendChild(a),t.appendChild(r),o.appendChild(t)});clearInterval(m),activeID=""}}),h=document.createElement("textarea");h.setAttribute("id","waTidy_agenda"),h.classList.add("waTidy_modal_input","waTidy_note_input");let v=document.createElement("p");v.classList.add("waTidy_modal_agendar"),v.innerText=language.reminder_date;let y=new Date;y.setMinutes(y.getMinutes()+5);let b=10>y.getDate()?"0"+y.getDate():y.getDate(),_=y.getMonth()+1<10?"0"+(y.getMonth()+1):y.getMonth()+1,w=y.getFullYear(),T=10>y.getHours()?"0"+y.getHours():y.getHours(),L=10>y.getMinutes()?"0"+y.getMinutes():y.getMinutes(),E=`${w}-${_}-${b}`,C=`${T}:${L}`,f=document.createElement("input");f.setAttribute("type","date"),f.setAttribute("id","dataInput"),f.setAttribute("min",E),f.value=E,f.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let A=document.createElement("p");A.classList.add("waTidy_modal_agendar"),A.innerText=language.reminder_time;let x=document.createElement("input");x.setAttribute("type","time"),x.setAttribute("id","timerInput"),x.setAttribute("value",C),x.classList.add("waTidy_modal_input","waTidy_modal_user_tab_input");let M=document.createElement("input");M.setAttribute("type","checkbox"),M.setAttribute("id","waTidy_reminder_calendar"),M.classList.add("waTidy_modal_label");let k=document.createElement("label");k.setAttribute("for","waTidy_reminder_calendar"),k.innerText=language.reminder_calendar,k.style.marginLeft="0.5em";let S=document.createElement("button");S.innerText=language.agendar,S.classList.add("waTidy_modal_button","waTidy_agendar_btn"),S.addEventListener("click",e=>addAgenda(e,g,p)),i.appendChild(r),i.appendChild(c),i.appendChild(h),i.appendChild(v),i.appendChild(f),i.appendChild(A),i.appendChild(x),i.appendChild(S),l.appendChild(i),n.appendChild(s),n.appendChild(o),n.appendChild(p),l.appendChild(n),a.appendChild(d),a.appendChild(l),t.appendChild(a),document.body.appendChild(t)},injectQuickActionButtons=async()=>{let e={async agendarMsg(){let e=document.createElement("div");e.setAttribute("tag","agendarMsg"),e.classList.add("waTidy_QA_btn_container"),e.setAttribute("aria-describedby","tooltip"),e.innerHTML=`<?xml version="1.0" encoding="UTF-8"?>
            <svg xmlns="http://www.w3.org/2000/svg" style="stroke:none" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="25" height="32"><path d="M17,10c-3.859,0-7,3.14-7,7s3.141,7,7,7,7-3.14,7-7-3.141-7-7-7Zm0,12c-2.757,0-5-2.243-5-5s2.243-5,5-5,5,2.243,5,5-2.243,5-5,5Zm1-5.414l1.707,1.707-1.414,1.414-2.293-2.293v-3.414h2v2.586Zm6-11.586v6.349c-.569-.704-1.247-1.312-2-1.818V5c0-.551-.448-1-1-1H3c-.551,0-1,.449-1,1v3h15c-2.142,0-4.106,.751-5.651,2H2v12h7.518c.506,.756,1.125,1.429,1.831,2H0V5c0-1.654,1.346-3,3-3h3V0h2V2h8V0h2V2h3c1.654,0,3,1.346,3,3Z"/></svg>`,e.addEventListener("click",showAgendarMsg),GFN.initTitle(e,language.idAgendarMsg,"right"),l.appendChild(e);let t=await readLocalStorage("agendaMsg");window.postMessage({request:"userNotesLenght",dados:{camp:"agendarMsg",banco:t}},"*")},eventCalendario(){let e=document.createElement("div");e.classList.add("waTidy_QA_btn_container"),e.setAttribute("aria-describedby","tooltip"),e.innerHTML=`<?xml version="1.0" encoding="iso-8859-1"?>
                                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 470 470" style="padding:3px" xml:space="preserve">
                                        <g>
                                            <path d="M462.5,425H7.5c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h455c4.143,0,7.5-3.358,7.5-7.5S466.643,425,462.5,425z" />
                                            <path d="M462.5,455H7.5c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h455c4.143,0,7.5-3.358,7.5-7.5S466.643,455,462.5,455z" />
                                            <path
                                                d="M462.5,30h-25v-7.5C437.5,10.093,427.406,0,415,0s-22.5,10.093-22.5,22.5V30h-75v-7.5C317.5,10.093,307.406,0,295,0
                                            s-22.5,10.093-22.5,22.5V30h-75v-7.5C197.5,10.093,187.407,0,175,0s-22.5,10.093-22.5,22.5V30h-75v-7.5C77.5,10.093,67.407,0,55,0
                                            S32.5,10.093,32.5,22.5V30h-25C3.358,30,0,33.358,0,37.5v365c0,4.142,3.358,7.5,7.5,7.5h455c4.143,0,7.5-3.358,7.5-7.5v-365
                                            C470,33.358,466.643,30,462.5,30z M407.5,22.5c0-4.136,3.364-7.5,7.5-7.5s7.5,3.364,7.5,7.5v30c0,4.136-3.364,7.5-7.5,7.5
                                            s-7.5-3.364-7.5-7.5V22.5z M287.5,22.5c0-4.136,3.364-7.5,7.5-7.5s7.5,3.364,7.5,7.5v30c0,4.136-3.364,7.5-7.5,7.5
                                            s-7.5-3.364-7.5-7.5V22.5z M167.5,22.5c0-4.136,3.364-7.5,7.5-7.5s7.5,3.364,7.5,7.5v30c0,4.136-3.364,7.5-7.5,7.5
                                            s-7.5-3.364-7.5-7.5V22.5z M47.5,22.5c0-4.136,3.364-7.5,7.5-7.5s7.5,3.364,7.5,7.5v30c0,4.136-3.364,7.5-7.5,7.5
                                            s-7.5-3.364-7.5-7.5V22.5z M32.5,45v7.5C32.5,64.907,42.593,75,55,75s22.5-10.093,22.5-22.5V45h75v7.5
                                            c0,12.407,10.093,22.5,22.5,22.5s22.5-10.093,22.5-22.5V45h75v7.5c0,12.407,10.094,22.5,22.5,22.5s22.5-10.093,22.5-22.5V45h75v7.5
                                            c0,12.407,10.094,22.5,22.5,22.5s22.5-10.093,22.5-22.5V45H455v77.3H15V45H32.5z M15,395V137.3h440V395H15z"
                                            />
                                            <path d="M412,226.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S416.143,226.8,412,226.8z" />
                                            <path d="M331,226.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S335.143,226.8,331,226.8z" />
                                            <path d="M250,226.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S254.143,226.8,250,226.8z" />
                                            <path d="M169,226.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S173.142,226.8,169,226.8z" />
                                            <path d="M88,226.8H58c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S92.142,226.8,88,226.8z" />
                                            <path d="M331,280.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S335.143,280.8,331,280.8z" />
                                            <path d="M250,280.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S254.143,280.8,250,280.8z" />
                                            <path d="M169,280.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S173.142,280.8,169,280.8z" />
                                            <path d="M88,280.8H58c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S92.142,280.8,88,280.8z" />
                                            <path d="M331,334.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S335.143,334.8,331,334.8z" />
                                            <path d="M412,280.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S416.143,280.8,412,280.8z" />
                                            <path d="M412,334.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S416.143,334.8,412,334.8z" />
                                            <path d="M250,334.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S254.143,334.8,250,334.8z" />
                                            <path d="M169,334.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S173.142,334.8,169,334.8z" />
                                            <path d="M88,334.8H58c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S92.142,334.8,88,334.8z" />
                                            <path d="M412,172.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S416.143,172.8,412,172.8z" />
                                            <path d="M331,172.8h-30c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S335.143,172.8,331,172.8z" />
                                            <path d="M250,172.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.143,0,7.5-3.358,7.5-7.5S254.143,172.8,250,172.8z" />
                                            <path d="M169,172.8h-30c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S173.142,172.8,169,172.8z" />
                                            <path d="M88,172.8H58c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h30c4.142,0,7.5-3.358,7.5-7.5S92.142,172.8,88,172.8z" />
                                        </g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
                                        <g></g>
            </svg>`,e.addEventListener("click",showCreateEventModal),GFN.initTitle(e,language.event_create_popover,"right"),l.appendChild(e)},async notas(){let e=document.createElement("div");e.setAttribute("tag","notesContainer"),e.classList.add("waTidy_QA_btn_container"),e.setAttribute("aria-describedby","tooltip"),e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1080 1080" style="padding:2px;">
                                        <path
                                            d="M1017.67,259.6H956.56V126a19,19,0,0,0-19-19H921.18V64.46c0-10.52-7.1-20.41-17.63-20.41H852.84c-10.53,0-20.42,9.89-20.42,20.41v42.48H821.65a19,19,0,0,0-19,19V848.7c0,36.14,37.15,77.09,55.42,95a5.13,5.13,0,0,0-.26,2v50.71a19,19,0,0,0,38,0V948.74c15.09-14,60.74-59.85,60.74-100V297.64h40.7V527.27a19,19,0,1,0,38,0V280C1035.3,269.49,1028.19,259.6,1017.67,259.6ZM870.46,82.09h12.68v24.85H870.46ZM840.66,145h77.86V259.6H840.66ZM918.52,848.7c0,16-20,43-38.93,62.76-18.89-19.78-38.93-46.66-38.93-62.76V297.64h77.86Z"
                                        />
                                        <path
                                            d="M689.07,1022.47H93.5c-26.9,0-48.8-20.75-48.8-46.27v-763c0-25.52,21.9-46.27,48.8-46.27h96.28v38H93.5c-5.83,0-10.76,3.78-10.76,8.23v763c0,4.46,4.93,8.23,10.76,8.23H689.07c5.82,0,10.75-3.77,10.75-8.23v-763c0-4.45-4.93-8.23-10.75-8.23H588.77v-38h100.3c26.91,0,48.79,20.75,48.79,46.27v763C737.86,1001.72,716,1022.47,689.07,1022.47Z"
                                        />
                                        <path
                                            d="M554,222.58l-9.77-53.26c-13.06-71.89-77-124-151.77-124-81.43,0-141.62,55.51-154.06,124l-9.76,53.26c-4.74,25.27,14.8,49.57,42.09,49.57H511.88C538.64,272.15,558.8,248.3,554,222.58Zm-278.2-46.41c9.23-50.82,54.05-92.82,116.66-92.82,56.42,0,104.48,39.06,114.37,92.82l9.76,53.25c.44,2-1.32,4.69-4.69,4.69H270.71c-2.81,0-5.28-2-4.69-4.69Z"
                                        />
                                        <path d="M218.86,522.41l-39.27-86a19,19,0,0,1,34.6-15.81L244.5,487l49.44-142.29a19,19,0,0,1,35.94,12.48L273.32,520a29.6,29.6,0,0,1-54.46,2.43Z" />
                                        <path d="M592.92,523.07H352c-10.5,0-19-7.85-19-18.35s8.52-18.34,19-18.34H592.92c10.5,0,19,7.85,19,18.34S603.42,523.07,592.92,523.07Z" />
                                        <path d="M218.86,790.47l-39.27-86a19,19,0,0,1,34.6-15.8l30.31,66.37,49.44-142.28a19,19,0,1,1,35.94,12.48L273.32,788.05a29.6,29.6,0,0,1-54.46,2.42Z" />
                                        <path d="M580.24,788H339.33c-10.5,0-19-9.88-19-20.38s8.52-20.38,19-20.38H580.24c10.5,0,19,9.88,19,20.38S590.74,788,580.24,788Z" />
                                        <path d="M441,153.22c0,26.75-21.94,48.44-48.81,48.44S343.37,180,343.37,153.22a48.82,48.82,0,0,1,97.63,0Z" />
            </svg>`,e.addEventListener("click",showNotesModal),l.appendChild(e),GFN.initTitle(e,language.note_placeholder,"right");let t=await readLocalStorage("notes");window.postMessage({request:"userNotesLenght",dados:{camp:"notesContainer",banco:t}},"*")}},t=document.querySelector('div[data-testid="conversation-panel-body"]'),a=document.createElement("img");a.setAttribute("src",chrome.runtime.getURL("assets/images/icons/WaTidy 40 x 40.png")),a.classList.add("waTidy_QA_container"),GFN.initTitle(a,language.watidyFuncoesOpenClose,"right"),a.style.width="40px",a.style.cursor="pointer";let l=document.createElement("div");l.classList.add("waTidy_QA_container"),l.style.display="none",l.style.marginBottom="2.8rem",l.style.left="0.9rem",e.agendarMsg(),e.eventCalendario(),e.notas();let i=document.createElement("div");i.classList.add("waTidy_QA_btn_container"),i.setAttribute("aria-describedby","tooltip"),i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1080 1080">
                                            <path d="M268.85,766.66H134.05A14.16,14.16,0,0,1,122.7,744L241.4,585a40.19,40.19,0,0,0-80.14,4.39H132.92a68.53,68.53,0,0,1,137.06,0,14.13,14.13,0,0,1-2.82,8.47L162.3,738.33H268.85Z" />
                                            <path d="M436.26,766.66H407.93V684H330.27a14.16,14.16,0,0,1-11.71-22.14L410.39,527a14.17,14.17,0,0,1,25.87,8V655.69h28.86V684H436.26Zm-79.21-111h50.88V581Z" />
                                            <rect x="551.03" y="255.4" width="28.33" height="56.4" />
                                            <rect x="551" y="789.31" width="28.33" height="56.4" />
                                            <rect x="803.94" y="536.41" width="56.4" height="28.33" />
                                            <path d="M564.75,563.26a14.11,14.11,0,0,1-10-4.15l-52.24-52.24,20-20,42.23,42.23L687.31,406.5l20,20L574.76,559.11A14.09,14.09,0,0,1,564.75,563.26Z" />
                                            <path d="M200,335.23a69.81,69.81,0,0,1,0-98.73l60.36-60.37a69.81,69.81,0,0,1,98.75,0l-20,20a41.49,41.49,0,0,0-58.67,0L220,256.53a41.48,41.48,0,0,0,0,58.66Z" />
                                            <path d="M225.75,355.13h0a14.16,14.16,0,0,1-10-4.15L200,335.22l20-20,5.72,5.73,119-119-5.72-5.72,20-20,15.74,15.74a14.16,14.16,0,0,1,0,20L235.77,351A14.16,14.16,0,0,1,225.75,355.13Z" />
                                            <path d="M930.37,335.23l-20-20a41.48,41.48,0,0,0,0-58.66L850,196.16a41.5,41.5,0,0,0-58.68,0l-20-20a69.79,69.79,0,0,1,98.74,0l60.37,60.37a69.83,69.83,0,0,1,0,98.73Z" />
                                            <path d="M904.61,355.13a14.14,14.14,0,0,1-10-4.15L755.52,211.9a14.17,14.17,0,0,1,0-20l15.74-15.74,20,20-5.72,5.72,119,119,5.72-5.72,20,20L914.64,351a14.16,14.16,0,0,1-10,4.15Z" />
                                            <path
                                                d="M565.16,897.15A345.85,345.85,0,0,1,319.51,795.67l20-20.08a317.67,317.67,0,0,0,225.65,93.23c176.3,0,319.73-143.43,319.73-319.72S741.46,229.37,565.16,229.37c-150.07,0-281.6,106.38-312.73,252.94l-27.72-5.89C258.61,316.86,401.79,201,565.16,201c191.92,0,348.06,156.14,348.06,348.06S757.08,897.15,565.16,897.15Z"
                                            />
                                            <rect x="817.98" y="788.45" width="28.33" height="147.45" transform="translate(-365.92 840.92) rotate(-45)" />
                                            <rect x="224.5" y="848.01" width="147.45" height="28.33" transform="translate(-522.3 463.39) rotate(-45)" />
                                        </svg>`,i.addEventListener("click",showAddReminderModal),GFN.initTitle(i,language.reminder_btn_popover,"right"),openQA(a,l),l.appendChild(i),t.appendChild(l),t.appendChild(a)},openQA=(e,t)=>{!1===openQAActive?(t.style.display="none",openQAEstado=!1):(t.style.display="block",openQAEstado=!0),e.addEventListener("click",function(){!1===openQAEstado?(t.style.display="block",openQAActive=!0,openQAEstado=!0):(t.style.display="none",openQAActive=!1,openQAEstado=!1)})},resetQuickActionButtons=()=>{document.querySelector("#main")&&(document.querySelector(".waTidy_QA_container")?.remove(),setTimeout(()=>{injectQuickActionButtons(),injectChatContent()},300))},observer=new MutationObserver(function(e){e.forEach(e=>{e.addedNodes.forEach(e=>{"main"==e.id&&(injectQuickActionButtons(),injectChatContent())})})});observer.observe(document.querySelector("#app"),{subtree:!0,childList:!0}),window.addEventListener("message",e=>{if(e.data.activeID){let t=[];document.querySelectorAll(".waTidy_chats_list .check.active").forEach(e=>t.push(e.nextElementSibling.innerText)),chrome.storage.local.get("userTabs",a=>{let l=a.userTabs;l.forEach(t=>{t.chats.includes(e.data.activeID)&&(t.chats=t.chats.filter(t=>t!=e.data.activeID),chrome.storage.local.set({userTabs:l}))}),t.forEach(t=>{let a=l.find(e=>e.tag==t);a.chats.find(t=>t==e.data.activeID)||(a.chats.push(e.data.activeID),chrome.storage.local.set({userTabs:l}))}),init()})}if((e.data.activeIDForModal||e.data.activeIDForReminder||e.data.activeIDForNote)&&(activeID=e.data.activeIDForModal||e.data.activeIDForReminder||e.data.activeIDForNote),"getUserTabs"==e.data.message&&chrome.storage.local.get("userTabs",t=>{"initRenderUserTab"==e.data.action&&e.source.postMessage({userTabs:t.userTabs,action:"renderUserTag",isThroughSystem:e.data.isThroughSystem},e.origin),"initRenderUnreadNotifications"==e.data.action&&e.source.postMessage({userTabs:t.userTabs,action:"renderUnreadNotifications"},e.origin)}),"dataForEditTab"==e.data.message){let a=e.data.models,l=e.data.tag;chrome.storage.local.get("userTabs",t=>{let i=t.userTabs.find(e=>e.tag==l).chats,n=i.length,s=[],d=document.querySelector(".waTidy_chats_list").firstChild;a.forEach(t=>{let a=document.createElement("li");a.setAttribute("title",t.name),a.dataset.id=t.id;let d=document.createElement("div");d.classList.add("item-container");let r=document.createElement("span");r.classList.add("check"),r.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true">
                            <path d="M6 12L10.25 17L19 8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
                        </svg>`;let c=document.createElement("label");if(c.innerText="person"==t.type?`${t.name} (${t.id})`:`${t.name}`,d.appendChild(r),t.labelData?.length){let o=document.createElement("div");o.classList.add("waTidy_labelled_contact_container"),o.appendChild(c);let p=document.createElement("div");p.classList.add("waTidy_labelled_contact_labels_container"),t.labelData.forEach(t=>{let a=e.data.labelModels.find(e=>e.id==t).name,l=document.createElement("label");l.innerText=a,p.appendChild(l)}),o.appendChild(p),d.appendChild(o)}else d.appendChild(c);let g=document.createElement("div");g.classList.add("separator"),a.appendChild(d),a.appendChild(g),a.addEventListener("click",()=>{chrome.storage.local.get("license",e=>{e.license?(a.classList.toggle("active"),r.classList.toggle("active")):chrome.storage.local.get("userTabs",e=>{let t=e.userTabs.find(e=>e.tag==l);if(console.log(t),t.chats,console.log(n),n<5)n++,a.classList.toggle("active"),r.classList.toggle("active");else{let i="#modalShowTab",s=language.selecionar5NaFree;GFN.modalPremium(i,s)}})})});let u=i.some(e=>e.id===t.id);u&&(a.classList.add("active"),r.classList.add("active")),s.push(a)}),setTimeout(()=>{let e,t=document.createDocumentFragment(),a=document.createDocumentFragment();for(e=0;e<s.length;e++)s[e].classList.contains("active")?t.appendChild(s[e]):a.appendChild(s[e]);d.append(t),d.append(a)},100)})}if("dataForCopyChats"==e.data.message&&e.data.models.forEach(t=>{let a=document.querySelector(".waTidy_chats_list").firstChild,l=document.createElement("li");l.setAttribute("title",t.name),l.dataset.id=t.id;let i=document.createElement("div");i.classList.add("item-container");let n=document.createElement("span");n.classList.add("check"),n.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true">
                            <path d="M6 12L10.25 17L19 8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
            </svg>`;let s=document.createElement("label");if(s.innerText="person"==t.type?`${t.name} (${t.id})`:`${t.name}`,i.appendChild(n),t.labelData?.length){let d=document.createElement("div");d.classList.add("waTidy_labelled_contact_container"),d.appendChild(s);let r=document.createElement("div");r.classList.add("waTidy_labelled_contact_labels_container"),t.labelData.forEach(t=>{let a=e.data.labelModels.find(e=>e.id==t).name,l=document.createElement("label");l.innerText=a,r.appendChild(l)}),d.appendChild(r),i.appendChild(d)}else i.appendChild(s);let c=document.createElement("div");c.classList.add("separator"),l.appendChild(i),l.appendChild(c),l.addEventListener("click",()=>{l.classList.toggle("active"),n.classList.toggle("active")}),a.appendChild(l)}),"dataForImportByLabel"==e.data.message&&e.data.models.forEach(e=>{let t=document.querySelector(".waTidy_chats_list").firstChild,a=document.createElement("li");a.setAttribute("title",e.name),a.dataset.id=e.id;let l=document.createElement("div");l.classList.add("item-container");let i=document.createElement("span");i.classList.add("check"),i.innerHTML=`<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" focusable="false" aria-hidden="true">
                            <path d="M6 12L10.25 17L19 8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
                        </svg>`;let n=document.createElement("label");n.innerText=e.name,l.appendChild(i),l.appendChild(n);let s=document.createElement("div");s.classList.add("separator"),a.appendChild(l),a.appendChild(s),a.addEventListener("click",()=>{a.classList.toggle("active"),i.classList.toggle("active")}),t.appendChild(a)}),"saveImportByLabel"==e.data.message){let i=e.data.tab.tag,n=e.data.newChats;chrome.storage.local.get("userTabs",e=>{let t=e.userTabs;t.find(e=>e.tag==i).chats=n,chrome.storage.local.set({userTabs:t},init),console.log(i),chrome.runtime.sendMessage({action:"abaListUpdate",aba:i})})}"getUserReminders"==e.data.message&&chrome.storage.local.get("notifications",t=>{"initRenderReminderNotifications"==e.data.action&&e.source.postMessage({reminders:t.notifications,action:"renderReminderNotifications"},e.origin)}),"chatsReady"==e.data.message&&init()});const saveTabsimport=async e=>{let t=await readLocalStorage("userTabs"),a=document.querySelector(".waTidyIDContainer").getAttribute("abaSelect"),l=[];function i(e,t){let a=e.concat(t);return Array.from(new Set(a))}e.forEach(e=>{l.push(e.id)}),t.forEach(e=>{if(e.tag===a){let t=i(e.chats,l);e.chats=t;return}}),chrome.storage.local.set({userTabs:t},init),GFN.notificacao("success",language.import_planilha_success)};chrome.runtime.onMessage.addListener(async function(e,t,a){switch(e.type){case"controler":let l=await GFN.Wpp_Request(e.action,e.dados);chrome.runtime.sendMessage({type:"returnControler",response:JSON.stringify(l),id:e.id});break;case"atualizarAbas":document.querySelector(".waTidy_container")?.remove(),injectTopBar(),waitForEl(".menu",()=>{initSortable()});break;case"initLabelChatActive":etiqueta()}});