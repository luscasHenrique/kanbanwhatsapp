var language;const _initAtendente=async()=>{let e=(e,t)=>{if("finalizado"===t)e.querySelector(".atendenteDiv")?.remove();else if(null===e.querySelector(".atendenteDiv")){let a=document.createElement("div");a.classList.add("atendenteDiv");let n=document.createElement("p");n.innerHTML=t,n.classList.add("atendenteID"),a.appendChild(n),e.appendChild(a)}else e.querySelector(".atendenteID").innerHTML=t},t=async(e,t)=>{let a=(e,t)=>{let a="";return e.forEach(e=>{if(e.from.user===t&&void 0!==e.body){let n=e.body,i="";i=n=String(n),0!==(n=(n=n.substring(0,n.indexOf(":_*"))).replace("*","").replace("_","")).length&&(a=n),"*_#At"===(i=i.substring(0,5))&&(a="finalizado")}}),a},n=(e,t)=>{let a="";return e.forEach(e=>{if(e.from.user===t){let n=e.body,i="";i=n=String(n),0!==(n=(n=n.substring(0,n.indexOf(":_*"))).replace("*","").replace("_","")).length&&(a=n),"*_#At"===(i=i.substring(0,5))&&(a="finalizado")}}),a},i="",r=await WPP.chat.getMessages(e,{count:10});return"c.us"===(e=e.split("@"))[1]?n(r,t):a(r,t)},a=async(a,n)=>{let i=a.parentElement.parentElement.parentElement.parentElement,r=window[Ue].Contact.getFilteredContacts(!0).find(e=>e.__x_name===a.title);void 0===r&&(r=window[Ue].Chat._models.find(e=>e.__x_formattedTitle===a.title)),console.log(r);let s=await t(r.__x_id._serialized,n);s.length>40&&(s=s.substr(0,36),s+=" ..."),0===s.length?i.querySelector(".atendenteDiv")?.remove():e(i,s)},n=await WPP.conn.getMyUserId(),i=()=>document.querySelectorAll("._21S-L > ._7T_0D > .ggj6brxn.gfz4du6o.r7fjleex.g0rxnol2.lhj4utae.le5p0ye3.l7jjieqr._11JPr");i().forEach(e=>{a(e,n.user)})},_chatAtendentes=async()=>{let e=await WPP.conn.getMyUserId();await WPP.chat.openChatBottom(e=e.toString())},_enviarBackup=async e=>{let t=await WPP.conn.getMyUserId();await WPP.chat.sendTextMessage(t=t.toString(),`*_${language.label}:_*
 Backup autom\xe1tico realizado pelo sistema`,{createChat:!0}),await WPP.chat.sendFileMessage(t,e,{createChat:!0,type:"document",caption:"My document",filename:`${language.label} Backup.json`,mimetype:"text/plain"}),await WPP.chat.openChatBottom(t)},wppRequest={async _userNotesLenght(e){let t=await WPP.chat.getActiveChat().__x_id.user;await WPP.chat.getActiveChat().__x_composeContents.text;let a=e.banco.filter(e=>e.userID===t),n=a.length;if(0===n)return;let i=document.querySelector(`[tag="${e.camp}"]`),r=document.createElement("span");r.classList.add("l7jjieqr","cfzgl7ar","ei5e7seu","h0viaqh7","tpmajp1w","c0uhu3dl","riy2oczp","dsh4tgtl","sy6s5v3r","gz7w46tb","lyutrhe2","qfejxiq4","fewfhwl7","ovhn1urg","ap18qm3b","ikwl5qvt","j90th5db","aumms1qt"),r.setAttribute("style","position: absolute; left: 2rem;"),r.innerHTML=n,i.prepend(r)},async _save_editContato(e){console.log(e);let t=await WPP.contact.list();t.forEach(t=>{(t.__x_id&&"user"in t.__x_id&&t.__x_id.user==e.id||t.__x_phoneNumber&&"user"in t.__x_phoneNumber&&t.__x_phoneNumber.user==e.id)&&(t.__x_displayName=e.name,t.__x_formattedName=e.name,t.__x_formattedShortName=e.name,t.__x_formattedShortNameWithNonBreakingSpaces=e.name,t.__x_formattedUser=e.name,t.__x_mentionName=e.name,t.__x_name=e.name,t.__x_notifyName=t.__x_formattedPhone,t.__x_pushname=e.name,t.__x_searchName=e.name,t.__x_shortName=e.name,t.__x_verifiedName=e.name,"g.us"==t.__x_id.server&&window[Ue].Chat._models.forEach(t=>{t.__x_id.user==e.id&&(t.__x_formattedTitle=e.name)}))})},async _finalizarAtendimento(e){let t=await WPP.chat.getActiveChat(),a=t.__x_id.user;t.assinatura="null",console.log(t),a.length>17&&(a=`${a}@g.us`),!0===e.envTxt&&await WPP.chat.sendTextMessage(a,e.txt,{createChat:!0}),!0===e.arquivar&&WPP.chat.archive(a);var n=new KeyboardEvent("keydown",{isTrusted:!0,_lexicalHandled:!0,code:"Escape",which:27,bubbles:!0,composed:!0,keyCode:27,which:27,cancelable:!0,char:"\x1b",key:"Escape"});document.dispatchEvent(n)},async _initContatos(e){let t=await WPP.contact.list(),a={};t.forEach(e=>{e.__x_id&&"user"in e.__x_id?a[e.__x_id.user]=e:e.__x_phoneNumber&&"user"in e.__x_phoneNumber&&(a[e.__x_phoneNumber.user]=e)});for(let n=0;n<e.length;n++){let i=e[n],r=a[i.id];if(r){Object.assign(r,{__x_displayName:i.name,__x_formattedName:i.name,__x_formattedShortName:i.name,__x_formattedShortNameWithNonBreakingSpaces:i.name,__x_formattedUser:i.name,__x_mentionName:i.name,__x_name:i.name,__x_notifyName:r.__x_formattedPhone,__x_pushname:i.name,__x_searchName:i.name,__x_shortName:i.name,__x_verifiedName:i.name});let s=window[Ue].Chat._models.find(e=>e.__x_id.user==i.id);s&&(s.__x_formattedTitle=i.name)}}},async _initAtendente(){let e=window[Ue].Chat._models,t=document.querySelectorAll("._21S-L > ._7T_0D > .ggj6brxn.gfz4du6o.r7fjleex.g0rxnol2.lhj4utae.le5p0ye3.l7jjieqr._11JPr"),a=await WPP.conn.getMyUserId().user;async function n(e){var t,n;let i="",r=await WPP.chat.getMessages(e,{count:10}),s,l;return"c.us"===(e=e.split("@"))[1]?(s="",(t=r).forEach(e=>{if(e.from.user===a){let t=e.body,n="";n=t=String(t),0!==(t=(t=t.substring(0,t.indexOf(":_*"))).replace("*","").replace("_","")).length&&(s=t),"*_#At"===(n=n.substring(0,5))&&(s="finalizado")}}),s):(l="",(n=r).forEach(e=>{if(e.from.user===a&&void 0!==e.body){let t=e.body,n="";n=t=String(t),0!==(t=(t=t.substring(0,t.indexOf(":_*"))).replace("*","").replace("_","")).length&&(l=t),"*_#At"===(n=n.substring(0,5))&&(l="finalizado")}}),l)}async function i(e,t){if("finalizado"===t)e.querySelector(".atendenteDiv")?.remove();else if(null===e.querySelector(".atendenteDiv")){let a=document.createElement("div");a.classList.add("atendenteDiv");let n=document.createElement("p");n.innerHTML=t,n.classList.add("atendenteID"),a.appendChild(n),e.appendChild(a)}else e.querySelector(".atendenteID").innerHTML=t}t.forEach(async t=>{let a=t.parentElement.parentElement.parentElement.parentElement,r=e.find(e=>e.__x_formattedTitle===t.title);if(void 0==r)return;if((r?.assinatura=="null"||r?.assinatura=="finalizado")&&null==a.querySelector("em._11JPr")){a.querySelector(".atendenteDiv")?.remove();return}let s=await n(r.__x_id._serialized);if(r.assinatura=s,0==s.length){r.assinatura="null",a.querySelector(".atendenteDiv")?.remove();return}i(a,s)})},async getAllTabsData(e){let t=await WPP.contact.list(),a=e.data.tabsData,n=[];a.forEach(e=>{let a={id:e.tag,name:e.tag,participants:[]};e.chats.forEach(e=>{var n;let i,r={id:e.id,name:e.name?e.name:(n=e.id,i=t.find(e=>e.__x_id.user==n),i?i.__x_name:n),picture:e.picture};a.participants.push(r)}),n.push(a)}),e.data.campanha?e.source.postMessage({message:"tabsData",models:n},"*"):e.source.postMessage({message:"tabsWatidyContacts",models:n},"*")}};window.addEventListener("message",async e=>{switch(e.data.request){case"finalizarAtendimento":wppRequest._finalizarAtendimento(e.data.dados);break;case"initAtendente":let t=setInterval(()=>{window[Ue].Chat._models&&(wppRequest._initAtendente(),clearInterval(t))},200);break;case"watidyBackup":_enviarBackup(e.data.backup);break;case"chatAtendentes":_chatAtendentes();break;case"userNotesLenght":wppRequest._userNotesLenght(e.data.dados);break;case"language":language=e.data.language;break;case"save_editContato":wppRequest._save_editContato(e.data.contato);break;case"initContatos":let a=setInterval(()=>{window[Ue].Chat._models&&(wppRequest._initContatos(e.data.contatos),clearInterval(a))},200);break;case"getAllTabsData":wppRequest.getAllTabsData(e)}});