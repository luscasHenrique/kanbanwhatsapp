const GFN={assAtivo:!1,upUserActive:!1,language:void 0,isBussines:void 0,getStorage:async e=>new Promise((t,a)=>{chrome.storage.local.get(e,e=>{chrome.runtime.lastError?a(chrome.runtime.lastError):t(e)})}),svg(e,t){Snap.load(t,function(t){e.appendChild(t.node)})},DADOS_PLANILHA:{keys:[],content:[]},modal(e){let t=document.createElement("div");t.classList.add("modal"),document.body.appendChild(t);let a=document.createElement("div");a.classList.add("modal_content"),t.appendChild(a);let n=document.createElement("button");return n.addEventListener("click",()=>{t.remove()}),n.classList.add("modal_close"),e&&a.appendChild(n),[t,a,n]},aguarde:e=>new Promise(t=>{setTimeout(()=>{t()},e)}),notificacao(e,t){let a=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen(e){e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}});a.fire({icon:e,title:t})},isFree:async()=>new Promise(e=>{chrome.storage.local.get("license",t=>{let a=!1;e(a=!t.license)})}),createSwitch(e){let t=document.createElement("label");t.classList.add("switch");let a=document.createElement("input");a.type="checkbox";let n=document.createElement("span");return n.classList.add("slider"),n.classList.add("round"),t.appendChild(a),t.appendChild(n),e.appendChild(t),a},showImg(e,t){e.setAttribute("src",chrome.runtime.getURL(`assets/images/${t}`))},textToClipboard(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)},modalPremium(e,t){if(!1!=e&&document.querySelector(e).remove(),!watidyLabel){!function e(){let[t,a,n]=GFN.modal(!0);a.setAttribute("style","width: 30%;margin: 15% auto;");let r=document.createElement("h1");r.innerHTML=language.ContratarPremium,r.setAttribute("style","margin-bottom: 1.5rem"),a.appendChild(r);let i=document.createElement("button");i.innerHTML=language.ContratarAgora,i.classList.add("premium"),a.appendChild(i),i.addEventListener("click",()=>{window.open(labelLink.comprar,"_blank")})}();return}let a=document.createElement("div");a.classList.add("waTidy_modal");let n=document.createElement("div");n.classList.add("waTidy_modal_content"),n.style.width="50rem";let r=document.createElement("button");r.classList.add("waTidy_modal_close_btn"),r.addEventListener("click",()=>{a.remove()});let i=document.createElement("h1");i.classList.add("waTidy_modal_heading"),i.innerHTML=language?.AdiquiraPremium||"Adquira a vers\xe3o premium para ter acesso ilimitado a esta funcionalidade",i.style.textAlign="center",i.style.fontSize="2rem",i.style.marginBottom="1.5rem";let s=document.createElement("img");s.src="https://watidy.com.br/imagens/imgPay1.png",s.classList.add("imgPay"),s.addEventListener("click",function(){window.open(labelLink.anualx1,"_blank").focus()});let l=document.createElement("img");l.src="https://watidy.com.br/imagens/imgPay2.png",l.classList.add("imgPay"),l.addEventListener("click",function(){window.open(labelLink.anualx3,"_blank").focus()});let d=document.createElement("img");d.src="https://watidy.com.br/imagens/imgPay3.png",d.classList.add("imgPay"),d.addEventListener("click",function(){window.open(labelLink.anualx6,"_blank").focus()});let o=document.createElement("p");o.innerText=t,o.style.textAlign="center",o.style.marginTop="1rem",o.style.fontSize="1.1rem",n.appendChild(r),n.appendChild(i),n.appendChild(s),n.appendChild(l),n.appendChild(d),n.appendChild(o),a.appendChild(n),document.body.appendChild(a)},getHora(){let e=new Date,t=e.getHours(),a=e.getMinutes();return t<10&&(t="0"+t),a<10&&(a="0"+a),t+":"+a},initTitle(e,t,a){$(e).hover(()=>{let n=document.querySelector("#allTitle");n.innerHTML=t,GFN.initPopper(e,n,a)})},initPopper(e,t,a){let n=Popper.createPopper(e,t,{placement:a,modifiers:[{name:"offset",options:{offset:[0,5]}},]});function r(){t.setAttribute("data-show",""),n.update()}function i(){t.removeAttribute("data-show")}["mouseenter","focus"].forEach(t=>{e.addEventListener(t,r)}),["mouseleave","blur"].forEach(t=>{e.addEventListener(t,i)})},getData(){let e=new Date,t=String(e.getDate()).padStart(2,"0"),a;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${t}`},subtrData(e){let t=GFN.getData(),a=new Date(t)-new Date(e);return a/864e5},async Wpp_Request(e,t){let a=Math.random().toString(36).substring(2,10),n=new Promise(e=>{window.addEventListener("message",function(t){t.source===window&&"returnControler"===t.data.type&&t.data.id===a&&e(JSON.parse(t.data.response))})});return window.postMessage({type:"controler",action:e,dados:t,id:a},"*"),n},tabsAtualize:{async userTabsDataEntrada(e,t){let a=e.flatMap(e=>e.chats),n=a.find(e=>e.id===t&&null!=e.dataEntrada),r=n?.dataEntrada??Date.now();return r},countChatsWithActiveID(e,t){let a=0;return e&&e.length>0&&e.forEach(e=>{e.chats&&e.chats.length>0&&e.chats.forEach(e=>{e.id===t&&a++})}),a},async updateUser(e){if(GFN.upUserActive)return;GFN.upUserActive=!0,e||(e=await readLocalStorage("userTabs"));let t=await GFN.Wpp_Request("getActiveChat"),a={num:t.serialized},n={id:t.id,picture:await GFN.Wpp_Request("getPicture",a),name:document.querySelector('[data-testid="conversation-info-header-chat-title"]').innerText,dataEntrada:await GFN.tabsAtualize.userTabsDataEntrada(e,t.id),etiqueta:t.labels};e.forEach(e=>{let a=e.chats.findIndex(e=>e.id===t.id);-1!==a&&(e.chats[a]=n)}),chrome.storage.local.set({userTabs:e}),GFN.upUserActive=!1},async etiquetas(e,t){let a=await GFN.getStorage("userTabs");for(let n of(a=a.userTabs,console.log(a),a))for(let r of n.chats)r.id===e&&(r.etiqueta=t);await chrome.storage.local.set({userTabs:a})}},async newAbas(){let e=await readLocalStorage("userTabs");for(let t=0;t<e.length;t++){let a=[];e[t].chats.forEach(e=>{if(e.id||e.picture){a.push(e);return}let t={id:e,picture:void 0,name:void 0,valorDoNegocio:void 0,dataEntrada:Date.now(),etiqueta:[]};a.push(t)}),e[t].chats=a}chrome.storage.local.set({userTabs:e})},async modal_CRM_Free(){await Swal.fire({title:GFN.language.CRM_freeTeste,text:GFN.language.CRM_FreeAlerta,icon:"warning",confirmButtonColor:"#3085d6",confirmButtonText:"Comprar"}).then(e=>{e.isConfirmed&&window.open("http://waspeed.com.br","_blank")}),init()},converterData(e){var t,a=new Date(1e3*Math.floor(e/1e3)),n=("0"+a.getDate()).slice(-2);return n+"/"+("0"+(a.getMonth()+1)).slice(-2)+"/"+a.getFullYear()},numTransformWhats(e){let t=e.replace(/\D/g,"");return t.length<15?t.replace(/^(\d{2})(\d{2})(\d{4,5})(\d{4})$/,"+$1 $2 $3-$4"):t+"@g.us"}};GFN.newAbas();