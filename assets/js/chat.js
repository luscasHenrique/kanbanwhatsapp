window.Ue={};let parsingInterval,extensionId=document.querySelector(".waTidyIDContainer").getAttribute("id"),observing=!0;const waitForEl=(e,t)=>{document.querySelector(e)?t():setTimeout(()=>{waitForEl(e,t)},100)};function getStore(e){var t,a=0,n=[{id:"Store",conditions:function(e){return e.default&&e.default.Chat&&e.default.Msg?e.default:null}},{id:"MediaCollection",conditions:function(e){return e.default&&e.default.prototype&&(void 0!==e.default.prototype.processFiles||void 0!==e.default.prototype.processAttachments)?e.default:null}},{id:"MediaProcess",conditions:function(e){return e.BLOB?e:null}},{id:"Wap",conditions:function(e){return e.createGroup?e:null}},{id:"ServiceWorker",conditions:function(e){return e.default&&e.default.killServiceWorker?e:null}},{id:"State",conditions:function(e){return e.STATE&&e.STREAM?e:null}},{id:"GroupInvite",conditions:function(e){return e.queryGroupInviteCode?e:null}},{id:"WapDelete",conditions:function(e){return e.sendConversationDelete&&2==e.sendConversationDelete.length?e:null}},{id:"Presence2",conditions:function(e){return e.setPresenceAvailable&&e.setPresenceUnavailable?e:null}},{id:"Conn",conditions:function(e){return e.default&&e.default.ref&&e.default.refTTL?e.default:null}},{id:"WapQuery",conditions:function(e){return e.queryExist?e:e.default&&e.default.queryExist?e.default:null}},{id:"CryptoLib",conditions:function(e){return e.decryptE2EMedia?e:null}},{id:"OpenChat",conditions:function(e){return e.default&&e.default.prototype&&e.default.prototype.openChat?e.default:null}},{id:"UserConstructor",conditions:function(e){return e.default&&e.default.prototype&&e.default.prototype.isServer&&e.default.prototype.isUser?e.default:null}},{id:"SendTextMsgToChat",conditions:function(e){return e.sendTextMsgToChat?e.sendTextMsgToChat:null}},{id:"SendSeen",conditions:function(e){return e.sendSeen?e.sendSeen:null}},{id:"sendDelete",conditions:function(e){return e.sendDelete?e.sendDelete:null}},{id:"addAndSendMsgToChat",conditions:function(e){return e.addAndSendMsgToChat?e.addAndSendMsgToChat:null}},{id:"sendMsgToChat",conditions:function(e){return e.sendMsgToChat?e.sendMsgToChat:null}},{id:"Catalog",conditions:function(e){return e.Catalog?e.Catalog:null}},{id:"ReadSeen",conditions:function(e){return e.sendSeen?e:null}},{id:"bp",conditions:function(e){return e.default&&e.default.toString&&e.default.toString().includes("binaryProtocol deprecated version")?e.default:null}},{id:"MsgKey",conditions:function(e){return e.default&&e.default.toString&&e.default.toString().includes("MsgKey error: id is already a MsgKey")?e.default:null}},{id:"Parser",conditions:function(e){return e.convertToTextWithoutSpecialEmojis?e.default:null}},{id:"Builders",conditions:function(e){return e.TemplateMessage&&e.HydratedFourRowTemplate?e:null}},{id:"Me",conditions:function(e){return e.PLATFORMS&&e.Conn?e.default:null}},{id:"CallUtils",conditions:function(e){return e.sendCallEnd&&e.parseCall?e:null}},{id:"Identity",conditions:function(e){return e.queryIdentity&&e.updateIdentity?e:null}},{id:"MyStatus",conditions:function(e){return e.getStatus&&e.setMyStatus?e:null}},{id:"ChatStates",conditions:function(e){return e.sendChatStatePaused&&e.sendChatStateRecording&&e.sendChatStateComposing?e:null}},{id:"GroupActions",conditions:function(e){return e.sendExitGroup&&e.localExitGroup?e:null}},{id:"Features",conditions:function(e){return e.FEATURE_CHANGE_EVENT&&e.features?e:null}},{id:"MessageUtils",conditions:function(e){return e.storeMessages&&e.appendMessage?e:null}},{id:"WebMessageInfo",conditions:function(e){return e.WebMessageInfo&&e.WebFeatures?e.WebMessageInfo:null}},{id:"createMessageKey",conditions:function(e){return e.createMessageKey&&e.createDeviceSentMessage?e.createMessageKey:null}},{id:"Participants",conditions:function(e){return e.addParticipants&&e.removeParticipants&&e.promoteParticipants&&e.demoteParticipants?e:null}},{id:"WidFactory",conditions:function(e){return e.numberToWid&&e.createWid&&e.createWidFromWidLike?e:null}},{id:"Base",conditions:function(e){return e.setSubProtocol&&e.binSend&&e.actionNode?e:null}},{id:"Base2",conditions:function(e){return e.supportsFeatureFlags&&e.parseMsgStubProto&&e.binSend&&e.subscribeLiveLocation?e:null}},{id:"Versions",conditions:function(e){return e.loadProtoVersions&&e.default[15]&&e.default[16]&&e.default[17]?e:null}},{id:"Sticker",conditions:function(e){return e.default&&e.default.Sticker?e.default.Sticker:null}},{id:"Contact",conditions:function(e){var t=e.default&&e.default.models;return e.ContactCollection&&t?e.default:null}},{id:"Chat",conditions:function(e){var t=e.default&&e.default.models;return e.ChatCollection&&t?e.default:null}},{id:"MediaUpload",conditions:function(e){return e.default&&e.default.mediaUpload?e.default:null}},{id:"UploadUtils",conditions:function(e){return e.default&&e.default.encryptAndUpload?e.default:null}},{id:"Cmd",conditions:function(e){return e.Cmd?e.Cmd:null}},];for(t in e){var i=e[t];if("object"==typeof i&&null!==i){var r=Object.values(i)[0];if("object"==typeof r){for(var o in r={},i)r.value=e(o),r.value?n.forEach(function(e){if(e.conditions&&!e.foundedModule)try{var t=e.conditions(r.value);null!==t&&(a++,e.foundedModule=t)}catch(n){}}):r={value:r.value};return e=n.find(function(e){return"Store"===e.id}),window[Ue]=e.foundedModule?e.foundedModule:{},n.splice(n.indexOf(e),1),n.forEach(function(e){e.foundedModule&&(window[Ue][e.id]=e.foundedModule)}),window[Ue].sendMessage=function(){return window[Ue].SendTextMsgToChat.apply(window[Ue],[this].concat(Array.from(arguments)))},window[Ue].MediaCollection&&(window[Ue].MediaCollection.prototype.processFiles=window[Ue].MediaCollection.prototype.processFiles||window[Ue].MediaCollection.prototype.processAttachments)&&window[Ue]}}}}function getModules(){let e="parasite"+Date.now();if("function"==typeof webpackChunkwhatsapp_web_client){var t={};webpackChunkwhatsapp_web_client([],(t[e]=function(e,t,a){return getStore(a)},t),[e])}else webpackChunkwhatsapp_web_client.push([[e],[[e]],function(e){return getStore(e)},])}function initChats(){parsingInterval=setInterval(function(){window.Ue={},getModules(),(window[Ue]&&window[Ue].Chat&&window[Ue].Conn||window[Ue]&&window[Ue].Chat)&&(window.postMessage({message:"chatsReady"},"*"),clearInterval(parsingInterval))},1e3)}initChats();const resetAll=()=>{window[Ue].Chat._models.filter(e=>!e.archive).forEach(e=>e.__x_shouldAppearInList=!0)},renderUnread=async()=>{window[Ue].Chat._models.filter(e=>e.unreadCount<=0&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1)},renderAwaiting=()=>{window[Ue].Chat._models.filter(e=>!e.lastReceivedKey.fromMe&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1)},renderNeeds=()=>{window[Ue].Chat._models.filter(e=>e.lastReceivedKey.fromMe&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1)},renderGroups=()=>{window[Ue].Chat._models.filter(e=>!e.isGroup&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1)},renderOnetoOne=()=>{window[Ue].Chat._models.filter(e=>e.isGroup&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1)},renderOfficial=()=>{window[Ue].Chat._models.filter(e=>!e.contact.businessProfile&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1)},renderBroadCast=()=>{window[Ue].Chat._models.filter(e=>!e.isBroadcast&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1)};let refresh=()=>{let e='[data-testid="chat-list-search"]';""==document.querySelector(e)?.innerText.trim()&&(document.querySelector(e).focus(),setTimeout(()=>{var e=new MouseEvent("mousedown",{view:window,bubbles:!0,cancelable:!0});document.querySelector('[data-testid="search"]').dispatchEvent(e)},200),observing=!0)};const renderSystemTab=(e,t=!1)=>{switch(t||window[Ue].Cmd.closeChat(window[Ue].Chat.getActive()),resetAll(),e){case"tab_all":break;case"tab_unread":renderUnread();break;case"tab_awaiting_reply":renderAwaiting();break;case"tab_needs_reply":renderNeeds();break;case"tab_groups":renderGroups();break;case"tab_1_1":renderOnetoOne();break;case"tab_official_accounts":renderOfficial();break;case"tab_broadcasts":renderBroadCast()}setTimeout(refresh,t?300:200)},renderUserTab=(e,t)=>{let a=document.querySelector('input[name="menu"]:checked').dataset?.tag,n=e.find(e=>e.tag==a).chats;t||window[Ue].Cmd.closeChat(window[Ue].Chat.getActive()),resetAll(),window[Ue].Chat._models.filter(e=>!n.some(t=>t.id===e.id.user)&&!e.archive).forEach(e=>e.__x_shouldAppearInList=!1),setTimeout(refresh,t?300:200)},initRenderUserTab=(e=!1)=>{window.postMessage({message:"getUserTabs",action:"initRenderUserTab",isThroughSystem:e},"*")},renderUnreadNotifications=e=>{let t=window[Ue].Chat._models.filter(e=>!e.archive);e.forEach(e=>{let a=e.chats.length&&e.chats.some(e=>t.find(t=>t.id.user==e)?.unreadCount),n=document.querySelector(`[data-id='${e.tag}']`);a?n.classList.add("menu_item_idicator"):n?.classList.remove("menu_item_idicator")});["tab_all","tab_unread","tab_needs_reply","tab_awaiting_reply","tab_groups","tab_1_1","tab_broadcasts"].forEach(e=>{if(!document.querySelector(`[data-id='${e}']`))return;let a;switch(e){case"tab_all":a=window[Ue].Chat._models;break;case"tab_unread":a=window[Ue].Chat._models.filter(e=>e.unreadCount>0);break;case"tab_needs_reply":a=window[Ue].Chat._models.filter(e=>!e.lastReceivedKey);break;case"tab_awaiting_reply":a=window[Ue].Chat._models.filter(e=>e.lastReceivedKey);break;case"tab_groups":a=window[Ue].Chat._models.filter(e=>e.isGroup);break;case"tab_1_1":a=window[Ue].Chat._models.filter(e=>!e.isGroup);break;case"tab_broadcasts":a=window[Ue].Chat._models.filter(e=>e.isBroadcast)}let n=a.length&&a.some(e=>t.find(t=>t.id.user==e.id.user)?.unreadCount),i=document.querySelector(`[data-id='${e}']`);i.querySelector(".menu_text").innerText=`${i.querySelector(".menu_text").innerText.split(" (")[0]} (${a.filter(e=>!e.archive).length||0})`,n?i.classList.add("menu_item_idicator"):i.classList.remove("menu_item_idicator")})},getTimezoneOffset=()=>{let e=e=>(e<10?"0":"")+e;var t,a=new Date().getTimezoneOffset();return(a<0?"+":"-")+e((a=Math.abs(a))/60|0)+e(a%60)},renderReminderNotifications=e=>{let t=document.querySelector("label[for='notifications']"),a=new Date,n=e.some(e=>{let t=`${e.date}T${e.time}:00${getTimezoneOffset()}`;return new Date(t)<=a&&!e.read}),i=e.filter(e=>{let t=`${e.date}T${e.time}:00${getTimezoneOffset()}`;return new Date(t)<=a&&!e.read}).length;t.setAttribute("data-count",i),n?t.classList.add("notif_item_indicator"):t.classList.remove("notif_item_indicator")},initRenderNotifications=()=>{window.postMessage({message:"getUserTabs",action:"initRenderUnreadNotifications"},"*"),window.postMessage({message:"getUserReminders",action:"initRenderReminderNotifications"},"*")};setInterval(initRenderNotifications,2e3);const generateCSV=e=>{let t=(e,t)=>t||"",a=Object.keys(e[0]),n=[a.join(","),...e.map(e=>a.map(a=>JSON.stringify(e[a],t)).join(","))].join("\r\n");return n},importChatsByLabel=(e,t)=>{let a=t.data.tab,n=[],i=new Set,r={};for(let o of e){let s=window[Ue].Label._models.find(e=>e.id==o).labelItemCollection._models;if(s&&0!=s.length)for(let d of s){if(i.has(d.__x_parentId))continue;i.add(d.__x_parentId);let l=r[d.__x_parentId];if(l||(l=window[Ue].Chat._models.find(e=>e.__x_id._serialized==d.__x_parentId),r[d.__x_parentId]=l),!l)continue;let c={id:l.__x_id.user,picture:l.picture,name:l.__x_contact.__x_displayName||l.__x_contact.__x_searchName,valorDoNegocio:null,etiqueta:l.__x_labels};n.push(c)}}t.source.postMessage({message:"saveImportByLabel",tab:a,newChats:n},t.origin)};window.addEventListener("message",e=>{if("getActiveID"==e.data.message&&e.source.postMessage({activeID:window[Ue].Chat.getActive().id.user},e.origin),"getActiveIDForModal"==e.data.message&&e.source.postMessage({activeIDForModal:window[Ue].Chat.getActive().id.user},e.origin),"getActiveIDForReminder"==e.data.message&&e.source.postMessage({activeIDForReminder:window[Ue].Chat.getActive().id.user},e.origin),"getActiveIDForNote"==e.data.message&&e.source.postMessage({activeIDForNote:window[Ue].Chat.getActive().id.user},e.origin),"getCurrentTabChats"==e.data.message){let t=document.querySelector('input[name="menu"]:checked'),a=t.dataset.tag,n=[],i=window[Ue].Contact.getFilteredContacts(!0);if("system"==t.dataset.type)switch(a){case"tab_all":n=window[Ue].Chat._models.filter(e=>!e.archive);break;case"tab_unread":n=window[Ue].Chat._models.filter(e=>e.unreadCount>0&&!e.archive);break;case"tab_awaiting_reply":n=window[Ue].Chat._models.filter(e=>e.lastReceivedKey.fromMe&&!e.archive);break;case"tab_needs_reply":n=window[Ue].Chat._models.filter(e=>!e.lastReceivedKey.fromMe&&!e.archive);break;case"tab_groups":n=window[Ue].Chat._models.filter(e=>e.isGroup&&!e.archive);break;case"tab_1_1":n=window[Ue].Chat._models.filter(e=>!e.isGroup&&!e.archive);break;case"tab_official_accounts":n=window[Ue].Chat._models.filter(e=>e.contact.businessProfile&&!e.archive);break;case"tab_broadcasts":n=window[Ue].Chat._models.filter(e=>e.isBroadcast&&!e.archive)}else{let r=e.data.userTabsForExport.find(e=>e.tag==a).chats;console.log(r),r.forEach(e=>{console.log(e.id),i.find(t=>t.id.user==e.id)?n.push(i.find(t=>t.id.user==e.id)):window[Ue].Contact.getGroupContacts().find(t=>t.id.user==e.id)?n.push(window[Ue].Chat._models.find(t=>t.id.user==e.id)):window[Ue].Chat._models.find(t=>t.id.user==e.id)&&n.push(window[Ue].Chat._models.find(t=>t.id.user==e.id)),console.log(n)})}let o=n.filter(e=>!e.isGroup),s=n.filter(e=>e.isGroup),d=[];o.forEach(e=>{let t={Name:e.name||e.contact.displayName,Number:e.id.user};d.push(t)}),s.forEach(e=>{let t={Name:e.formattedTitle,Number:null};d.push(t);e.groupMetadata.participants._models.forEach(e=>{let t={Name:e.contact.displayName||e.id.user,Number:e.id.user};console.log(e.id.user),d.push(t)})}),window.open("data:text/csv;charset=utf-8,"+generateCSV(d))}if(e.data.userTabs&&"renderUserTag"==e.data.action&&renderUserTab(e.data.userTabs,e.data.isThroughSystem),e.data.action){if("getDataForEditTab"==e.data.action&&getDataForEditTab(e),"getDataForCopyChats"==e.data.action){async function l(){let t=[],a=[];if(window[Ue].Label._models.forEach(e=>{let t={id:e.id,name:e.name};a.push(t)}),"user"===e.data.tab.type){let n=e.data.tab.chats,i=window[Ue].Contact.getFilteredContacts(!0),r=window[Ue].Contact.getGroupContacts(),o=window[Ue].Chat._models;n.forEach(e=>{let a=i.find(t=>t.id.user===e.id)||r.find(t=>t.id.user===e.id)||o.find(t=>t.id.user===e.id);if(a){let n={id:a.id.user,name:a.contact?.displayName||a.name||a.id.user,type:a.isGroup?"group":"person",labelData:a.labels};t.push(n)}})}else{let s=[];switch(e.data.tab.tag){case"tab_all":s=[...window[Ue].Chat._models.filter(e=>!e.contact.name),...window[Ue].Contact.getFilteredContacts(!0),...window[Ue].Contact.getGroupContacts()];break;case"tab_unread":s=window[Ue].Chat._models.filter(e=>e.unreadCount>0&&!e.archive);break;case"tab_awaiting_reply":s=window[Ue].Chat._models.filter(e=>e.lastReceivedKey.fromMe&&!e.archive);break;case"tab_needs_reply":s=window[Ue].Chat._models.filter(e=>!e.lastReceivedKey.fromMe&&!e.archive);break;case"tab_groups":s=window[Ue].Chat._models.filter(e=>e.isGroup&&!e.archive);break;case"tab_1_1":s=window[Ue].Chat._models.filter(e=>!e.isGroup&&!e.archive);break;case"tab_official_accounts":s=window[Ue].Chat._models.filter(e=>e.contact.businessProfile&&!e.archive);break;case"tab_broadcasts":s=window[Ue].Chat._models.filter(e=>e.isBroadcast&&!e.archive)}s.forEach(e=>{let a={id:e.id.user,name:e.contact?.displayName||e.name||e.id.user,type:e.isGroup?"group":"person",labelData:e.labels};t.push(a)})}return{models:t,labelModels:a}}l().then(t=>{e.source.postMessage({message:"dataForCopyChats",models:t.models,labelModels:t.labelModels},e.origin)}).catch(e=>{console.error(e)})}if("getDataForImportByLabel"==e.data.action){let c=window[Ue].Label._models,u=[];c.forEach(e=>{let t={id:e.id,name:e.name};u.push(t)}),e.source.postMessage({message:"dataForImportByLabel",models:u},e.origin)}if("importByLabel"==e.data.action){let f=[];document.querySelectorAll(".waTidy_chats_list .check.active").forEach(e=>f.push(e.closest("li").dataset.id)),importChatsByLabel(f,e)}if("openChat"==e.data.action){let p=e.data.id,h=window[Ue].Chat._models.find(e=>e.id.user==p);window[Ue].Cmd.openChatAt(h)}"renderReminderNotifications"==e.data.action&&renderReminderNotifications(e.data.reminders)}},!0);const observer=new MutationObserver(function(e){if(!observing)return;let t=!1;e.forEach(e=>{e.addedNodes.forEach(e=>{(Array.from(e.firstChild?.firstChild?.children).some(e=>e.classList.contains("ln8gz9je"))||e.classList.contains("ln8gz9je"))&&(t=!0)})}),t&&(observing=!1,setTimeout(()=>{let e=document.querySelector('input[name="menu"]:checked');"system"==e?.dataset.type&&renderSystemTab(e.dataset.tag,!0),"user"==e?.dataset.type&&initRenderUserTab(!0)},1e3))});observer.observe(document.querySelector("#pane-side"),{subtree:!0,childList:!0});const getDataForEditTab=async e=>{let t=window[Ue].Contact.getFilteredContacts(!0),a=[],n=window[Ue].Label._models,i=[];n.forEach(e=>{let t={id:e.id,name:e.name};i.push(t)}),t.forEach(e=>{let t={id:e.id.user,name:e.name||e.id.user,type:"person",labelData:e.labels};a.push(t)});window[Ue].Contact.getGroupContacts().forEach(e=>{let t={id:e.id.user,name:e.name||e.id.user,type:"group",labelData:e.labels};a.push(t)});window[Ue].Chat._models.filter(e=>!e.contact.name).forEach(e=>{let t={id:e.id.user,name:e.contact?.displayName||e.name||e.id.user,type:"person",labelData:e.labels};a.push(t)}),e.source.postMessage({message:"dataForEditTab",models:a,labelModels:i,tag:e.data.tag},e.origin)};